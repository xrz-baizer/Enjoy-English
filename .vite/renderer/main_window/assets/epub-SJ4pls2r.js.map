{"version":3,"file":"epub-SJ4pls2r.js","sources":["../../../../node_modules/foliate-js/epub.js"],"sourcesContent":["import * as CFI from './epubcfi.js'\n\nconst NS = {\n    CONTAINER: 'urn:oasis:names:tc:opendocument:xmlns:container',\n    XHTML: 'http://www.w3.org/1999/xhtml',\n    OPF: 'http://www.idpf.org/2007/opf',\n    EPUB: 'http://www.idpf.org/2007/ops',\n    DC: 'http://purl.org/dc/elements/1.1/',\n    DCTERMS: 'http://purl.org/dc/terms/',\n    ENC: 'http://www.w3.org/2001/04/xmlenc#',\n    NCX: 'http://www.daisy.org/z3986/2005/ncx/',\n    XLINK: 'http://www.w3.org/1999/xlink',\n    SMIL: 'http://www.w3.org/ns/SMIL',\n}\n\nconst MIME = {\n    XML: 'application/xml',\n    NCX: 'application/x-dtbncx+xml',\n    XHTML: 'application/xhtml+xml',\n    HTML: 'text/html',\n    CSS: 'text/css',\n    SVG: 'image/svg+xml',\n    JS: /\\/(x-)?(javascript|ecmascript)/,\n}\n\n// https://www.w3.org/TR/epub-33/#sec-reserved-prefixes\nconst PREFIX = {\n    a11y: 'http://www.idpf.org/epub/vocab/package/a11y/#',\n    dcterms: 'http://purl.org/dc/terms/',\n    marc: 'http://id.loc.gov/vocabulary/',\n    media: 'http://www.idpf.org/epub/vocab/overlays/#',\n    onix: 'http://www.editeur.org/ONIX/book/codelists/current.html#',\n    rendition: 'http://www.idpf.org/vocab/rendition/#',\n    schema: 'http://schema.org/',\n    xsd: 'http://www.w3.org/2001/XMLSchema#',\n    msv: 'http://www.idpf.org/epub/vocab/structure/magazine/#',\n    prism: 'http://www.prismstandard.org/specifications/3.0/PRISM_CV_Spec_3.0.htm#',\n}\n\nconst RELATORS = {\n    art: 'artist',\n    aut: 'author',\n    clr: 'colorist',\n    edt: 'editor',\n    ill: 'illustrator',\n    nrt: 'narrator',\n    trl: 'translator',\n    pbl: 'publisher',\n}\n\nconst ONIX5 = {\n    '02': 'isbn',\n    '06': 'doi',\n    '15': 'isbn',\n    '26': 'doi',\n    '34': 'issn',\n}\n\n// convert to camel case\nconst camel = x => x.toLowerCase().replace(/[-:](.)/g, (_, g) => g.toUpperCase())\n\n// strip and collapse ASCII whitespace\n// https://infra.spec.whatwg.org/#strip-and-collapse-ascii-whitespace\nconst normalizeWhitespace = str => str ? str\n    .replace(/[\\t\\n\\f\\r ]+/g, ' ')\n    .replace(/^[\\t\\n\\f\\r ]+/, '')\n    .replace(/[\\t\\n\\f\\r ]+$/, '') : ''\n\nconst filterAttribute = (attr, value, isList) => isList\n    ? el => el.getAttribute(attr)?.split(/\\s/)?.includes(value)\n    : typeof value === 'function'\n        ? el => value(el.getAttribute(attr))\n        : el => el.getAttribute(attr) === value\n\nconst getAttributes = (...xs) => el =>\n    el ? Object.fromEntries(xs.map(x => [camel(x), el.getAttribute(x)])) : null\n\nconst getElementText = el => normalizeWhitespace(el?.textContent)\n\nconst childGetter = (doc, ns) => {\n    // ignore the namespace if it doesn't appear in document at all\n    const useNS = doc.lookupNamespaceURI(null) === ns || doc.lookupPrefix(ns)\n    const f = useNS\n        ? (el, name) => el => el.namespaceURI === ns && el.localName === name\n        : (el, name) => el => el.localName === name\n    return {\n        $: (el, name) => [...el.children].find(f(el, name)),\n        $$: (el, name) => [...el.children].filter(f(el, name)),\n        $$$: useNS\n            ? (el, name) => [...el.getElementsByTagNameNS(ns, name)]\n            : (el, name) => [...el.getElementsByTagName(name)],\n    }\n}\n\nconst resolveURL = (url, relativeTo) => {\n    try {\n        if (relativeTo.includes(':')) return new URL(url, relativeTo)\n        // the base needs to be a valid URL, so set a base URL and then remove it\n        const root = 'https://invalid.invalid/'\n        const obj = new URL(url, root + relativeTo)\n        obj.search = ''\n        return decodeURI(obj.href.replace(root, ''))\n    } catch(e) {\n        console.warn(e)\n        return url\n    }\n}\n\nconst isExternal = uri => /^(?!blob)\\w+:/i.test(uri)\n\n// like `path.relative()` in Node.js\nconst pathRelative = (from, to) => {\n    if (!from) return to\n    const as = from.replace(/\\/$/, '').split('/')\n    const bs = to.replace(/\\/$/, '').split('/')\n    const i = (as.length > bs.length ? as : bs).findIndex((_, i) => as[i] !== bs[i])\n    return i < 0 ? '' : Array(as.length - i).fill('..').concat(bs.slice(i)).join('/')\n}\n\nconst pathDirname = str => str.slice(0, str.lastIndexOf('/') + 1)\n\n// replace asynchronously and sequentially\n// same technique as https://stackoverflow.com/a/48032528\nconst replaceSeries = async (str, regex, f) => {\n    const matches = []\n    str.replace(regex, (...args) => (matches.push(args), null))\n    const results = []\n    for (const args of matches) results.push(await f(...args))\n    return str.replace(regex, () => results.shift())\n}\n\nconst regexEscape = str => str.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\n\nconst tidy = obj => {\n    for (const [key, val] of Object.entries(obj))\n        if (val == null) delete obj[key]\n        else if (Array.isArray(val)) {\n            obj[key] = val.filter(x => x).map(x =>\n                typeof x === 'object' && !Array.isArray(x) ? tidy(x) : x)\n            if (!obj[key].length) delete obj[key]\n            else if (obj[key].length === 1) obj[key] = obj[key][0]\n        }\n        else if (typeof val === 'object') {\n            obj[key] = tidy(val)\n            if (!Object.keys(val).length) delete obj[key]\n        }\n    const keys = Object.keys(obj)\n    if (keys.length === 1 && keys[0] === 'name') return obj[keys[0]]\n    return obj\n}\n\n// https://www.w3.org/TR/epub/#sec-prefix-attr\nconst getPrefixes = doc => {\n    const map = new Map(Object.entries(PREFIX))\n    const value = doc.documentElement.getAttributeNS(NS.EPUB, 'prefix')\n        || doc.documentElement.getAttribute('prefix')\n    if (value) for (const [, prefix, url] of value\n        .matchAll(/(.+): +(.+)[ \\t\\r\\n]*/g)) map.set(prefix, url)\n    return map\n}\n\n// https://www.w3.org/TR/epub-rs/#sec-property-values\n// but ignoring the case where the prefix is omitted\nconst getPropertyURL = (value, prefixes) => {\n    if (!value) return null\n    const [a, b] = value.split(':')\n    const prefix = b ? a : null\n    const reference = b ? b : a\n    const baseURL = prefixes.get(prefix)\n    return baseURL ? baseURL + reference : null\n}\n\nconst getMetadata = opf => {\n    const { $ } = childGetter(opf, NS.OPF)\n    const $metadata = $(opf.documentElement, 'metadata')\n\n    // first pass: convert to JS objects\n    const els = Object.groupBy($metadata.children, el =>\n        el.namespaceURI === NS.DC ? 'dc'\n        : el.namespaceURI === NS.OPF && el.localName === 'meta' ?\n            (el.hasAttribute('name') ? 'legacyMeta' : 'meta') : '')\n    const baseLang = $metadata.getAttribute('xml:lang')\n        ?? opf.documentElement.getAttribute('xml:lang') ?? 'und'\n    const prefixes = getPrefixes(opf)\n    const parse = el => {\n        const property = el.getAttribute('property')\n        const scheme = el.getAttribute('scheme')\n        return {\n            property: getPropertyURL(property, prefixes) ?? property,\n            scheme: getPropertyURL(scheme, prefixes) ?? scheme,\n            lang: el.getAttribute('xml:lang'),\n            value: getElementText(el),\n            props: getProperties(el),\n            // `opf:` attributes from EPUB 2 & EPUB 3.1 (removed in EPUB 3.2)\n            attrs: Object.fromEntries(Array.from(el.attributes)\n                .filter(attr => attr.namespaceURI === NS.OPF)\n                .map(attr => [attr.localName, attr.value])),\n        }\n    }\n    const refines = Map.groupBy(els.meta ?? [], el => el.getAttribute('refines'))\n    const getProperties = el => {\n        const els = refines.get(el ? '#' + el.getAttribute('id') : null)\n        if (!els) return null\n        return Object.groupBy(els.map(parse), x => x.property)\n    }\n    const dc = Object.fromEntries(Object.entries(Object.groupBy(els.dc, el => el.localName))\n        .map(([name, els]) => [name, els.map(parse)]))\n    const properties = getProperties() ?? {}\n    const legacyMeta = Object.fromEntries(els.legacyMeta?.map(el =>\n        [el.getAttribute('name'), el.getAttribute('content')]) ?? [])\n\n    // second pass: map to webpub\n    const one = x => x?.[0]?.value\n    const prop = (x, p) => one(x?.props?.[p])\n    const makeLanguageMap = x => {\n        if (!x) return null\n        const alts = x.props?.['alternate-script'] ?? []\n        const altRep = x.attrs['alt-rep']\n        if (!alts.length && (!x.lang || x.lang === baseLang) && !altRep) return x.value\n        const map = { [x.lang ?? baseLang]: x.value }\n        if (altRep) map[x.attrs['alt-rep-lang']] = altRep\n        for (const y of alts) map[y.lang] ??= y.value\n        return map\n    }\n    const makeContributor = x => x ? ({\n        name: makeLanguageMap(x),\n        sortAs: makeLanguageMap(x.props?.['file-as']?.[0]) ?? x.attrs['file-as'],\n        role: x.props?.role?.filter(x => x.scheme === PREFIX.marc + 'relators')\n            ?.map(x => x.value) ?? [x.attrs.role],\n        code: prop(x, 'term') ?? x.attrs.term,\n        scheme: prop(x, 'authority') ?? x.attrs.authority,\n    }) : null\n    const makeCollection = x => ({\n        name: makeLanguageMap(x),\n        // NOTE: webpub requires number but EPUB allows values like \"2.2.1\"\n        position: one(x.props?.['group-position']),\n    })\n    const makeAltIdentifier = x => {\n        const { value } = x\n        if (/^urn:/i.test(value)) return value\n        if (/^doi:/i.test(value)) return `urn:${value}`\n        const type = x.props?.['identifier-type']\n        if (!type) {\n            const scheme = x.attrs.scheme\n            if (!scheme) return value\n            // https://idpf.github.io/epub-registries/identifiers/\n            // but no \"jdcn\", which isn't a registered URN namespace\n            if (/^(doi|isbn|uuid)$/i.test(scheme)) return `urn:${scheme}:${value}`\n            // NOTE: webpub requires scheme to be a URI; EPUB allows anything\n            return { scheme, value }\n        }\n        if (type.scheme === PREFIX.onix + 'codelist5') {\n            const nid = ONIX5[type.value]\n            if (nid) return `urn:${nid}:${value}`\n        }\n        return value\n    }\n    const belongsTo = Object.groupBy(properties['belongs-to-collection'] ?? [],\n        x => prop(x, 'collection-type') === 'series' ? 'series' : 'collection')\n    const mainTitle = dc.title?.find(x => prop(x, 'title-type') === 'main') ?? dc.title?.[0]\n    const metadata = {\n        identifier: getIdentifier(opf),\n        title: makeLanguageMap(mainTitle),\n        sortAs: makeLanguageMap(mainTitle?.props?.['file-as']?.[0])\n            ?? mainTitle?.attrs?.['file-as']\n            ?? legacyMeta?.['calibre:title_sort'],\n        subtitle: dc.title?.find(x => prop(x, 'title-type') === 'subtitle')?.value,\n        language: dc.language?.map(x => x.value),\n        description: one(dc.description),\n        publisher: makeContributor(dc.publisher?.[0]),\n        published: dc.date?.find(x => x.attrs.event === 'publication')?.value\n            ?? one(dc.date),\n        modified: one(properties[PREFIX.dcterms + 'modified'])\n            ?? dc.date?.find(x => x.attrs.event === 'modification')?.value,\n        subject: dc.subject?.map(makeContributor),\n        belongsTo: {\n            collection: belongsTo.collection?.map(makeCollection),\n            series: belongsTo.series?.map(makeCollection)\n            ?? legacyMeta?.['calibre:series'] ? {\n                name: legacyMeta?.['calibre:series'],\n                position: parseFloat(legacyMeta?.['calibre:series_index']),\n            } : null,\n        },\n        altIdentifier: dc.identifier?.map(makeAltIdentifier),\n        source: dc.source?.map(makeAltIdentifier), // NOTE: not in webpub schema\n        rights: one(dc.rights), // NOTE: not in webpub schema\n    }\n    const remapContributor = defaultKey => x => {\n        const keys = new Set(x.role?.map(role => RELATORS[role] ?? defaultKey))\n        return [keys.size ? keys : [defaultKey], x]\n    }\n    for (const [keys, val] of [].concat(\n        dc.creator?.map(makeContributor)?.map(remapContributor('author')) ?? [],\n        dc.contributor?.map(makeContributor)?.map(remapContributor('contributor')) ?? []))\n        for (const key of keys)\n            if (metadata[key]) metadata[key].push(val)\n            else metadata[key] = [val]\n    tidy(metadata)\n    if (metadata.altIdentifier === metadata.identifier)\n        delete metadata.altIdentifier\n\n    const rendition = {}\n    const media = {}\n    for (const [key, val] of Object.entries(properties)) {\n        if (key.startsWith(PREFIX.rendition))\n            rendition[camel(key.replace(PREFIX.rendition, ''))] = one(val)\n        else if (key.startsWith(PREFIX.media))\n            media[camel(key.replace(PREFIX.media, ''))] = one(val)\n    }\n    if (media.duration) media.duration = parseClock(media.duration)\n    return { metadata, rendition, media }\n}\n\nconst parseNav = (doc, resolve = f => f) => {\n    const { $, $$, $$$ } = childGetter(doc, NS.XHTML)\n    const resolveHref = href => href ? decodeURI(resolve(href)) : null\n    const parseLI = getType => $li => {\n        const $a = $($li, 'a') ?? $($li, 'span')\n        const $ol = $($li, 'ol')\n        const href = resolveHref($a?.getAttribute('href'))\n        const label = getElementText($a) || $a?.getAttribute('title')\n        // TODO: get and concat alt/title texts in content\n        const result = { label, href, subitems: parseOL($ol) }\n        if (getType) result.type = $a?.getAttributeNS(NS.EPUB, 'type')?.split(/\\s/)\n        return result\n    }\n    const parseOL = ($ol, getType) => $ol ? $$($ol, 'li').map(parseLI(getType)) : null\n    const parseNav = ($nav, getType) => parseOL($($nav, 'ol'), getType)\n\n    const $$nav = $$$(doc, 'nav')\n    let toc = null, pageList = null, landmarks = null, others = []\n    for (const $nav of $$nav) {\n        const type = $nav.getAttributeNS(NS.EPUB, 'type')?.split(/\\s/) ?? []\n        if (type.includes('toc')) toc ??= parseNav($nav)\n        else if (type.includes('page-list')) pageList ??= parseNav($nav)\n        else if (type.includes('landmarks')) landmarks ??= parseNav($nav, true)\n        else others.push({\n            label: getElementText($nav.firstElementChild), type,\n            list: parseNav($nav),\n        })\n    }\n    return { toc, pageList, landmarks, others }\n}\n\nconst parseNCX = (doc, resolve = f => f) => {\n    const { $, $$ } = childGetter(doc, NS.NCX)\n    const resolveHref = href => href ? decodeURI(resolve(href)) : null\n    const parseItem = el => {\n        const $label = $(el, 'navLabel')\n        const $content = $(el, 'content')\n        const label = getElementText($label)\n        const href = resolveHref($content.getAttribute('src'))\n        if (el.localName === 'navPoint') {\n            const els = $$(el, 'navPoint')\n            return { label, href, subitems: els.length ? els.map(parseItem) : null }\n        }\n        return { label, href }\n    }\n    const parseList = (el, itemName) => $$(el, itemName).map(parseItem)\n    const getSingle = (container, itemName) => {\n        const $container = $(doc.documentElement, container)\n        return $container ? parseList($container, itemName) : null\n    }\n    return {\n        toc: getSingle('navMap', 'navPoint'),\n        pageList: getSingle('pageList', 'pageTarget'),\n        others: $$(doc.documentElement, 'navList').map(el => ({\n            label: getElementText($(el, 'navLabel')),\n            list: parseList(el, 'navTarget'),\n        })),\n    }\n}\n\nconst parseClock = str => {\n    if (!str) return\n    const parts = str.split(':').map(x => parseFloat(x))\n    if (parts.length === 3) {\n        const [h, m, s] = parts\n        return h * 60 * 60 + m * 60 + s\n    }\n    if (parts.length === 2) {\n        const [m, s] = parts\n        return m * 60 + s\n    }\n    const [x, unit] = str.split(/(?=[^\\d.])/)\n    const n = parseFloat(x)\n    const f = unit === 'h' ? 60 * 60\n        : unit === 'min' ? 60\n        : unit === 'ms' ? .001\n        : 1\n    return n * f\n}\n\nclass MediaOverlay extends EventTarget {\n    #entries\n    #lastMediaOverlayItem\n    #sectionIndex\n    #audioIndex\n    #itemIndex\n    #audio\n    #volume = 1\n    #rate = 1\n    #state\n    constructor(book, loadXML) {\n        super()\n        this.book = book\n        this.loadXML = loadXML\n    }\n    async #loadSMIL(item) {\n        if (this.#lastMediaOverlayItem === item) return\n        const doc = await this.loadXML(item.href)\n        const resolve = href => href ? resolveURL(href, item.href) : null\n        const { $, $$$ } = childGetter(doc, NS.SMIL)\n        this.#audioIndex = -1\n        this.#itemIndex = -1\n        this.#entries = $$$(doc, 'par').reduce((arr, $par) => {\n            const text = resolve($($par, 'text')?.getAttribute('src'))\n            const $audio = $($par, 'audio')\n            if (!text || !$audio) return arr\n            const src = resolve($audio.getAttribute('src'))\n            const begin = parseClock($audio.getAttribute('clipBegin'))\n            const end = parseClock($audio.getAttribute('clipEnd'))\n            const last = arr.at(-1)\n            if (last?.src === src) last.items.push({ text, begin, end })\n            else arr.push({ src, items: [{ text, begin, end }] })\n            return arr\n        }, [])\n        this.#lastMediaOverlayItem = item\n    }\n    get #activeAudio() {\n        return this.#entries[this.#audioIndex]\n    }\n    get #activeItem() {\n        return this.#activeAudio?.items?.[this.#itemIndex]\n    }\n    #error(e) {\n        console.error(e)\n        this.dispatchEvent(new CustomEvent('error', { detail: e }))\n    }\n    #highlight() {\n        this.dispatchEvent(new CustomEvent('highlight', { detail: this.#activeItem }))\n    }\n    #unhighlight() {\n        this.dispatchEvent(new CustomEvent('unhighlight', { detail: this.#activeItem }))\n    }\n    async #play(audioIndex, itemIndex) {\n        this.#stop()\n        this.#audioIndex = audioIndex\n        this.#itemIndex = itemIndex\n        const src = this.#activeAudio?.src\n        if (!src || !this.#activeItem) return this.start(this.#sectionIndex + 1)\n\n        const url = URL.createObjectURL(await this.book.loadBlob(src))\n        const audio = new Audio(url)\n        this.#audio = audio\n        audio.volume = this.#volume\n        audio.playbackRate = this.#rate\n        audio.addEventListener('timeupdate', () => {\n            if (audio.paused) return\n            const t = audio.currentTime\n            const { items } = this.#activeAudio\n            if (t > this.#activeItem?.end) {\n                this.#unhighlight()\n                if (this.#itemIndex === items.length - 1) {\n                    this.#play(this.#audioIndex + 1, 0).catch(e => this.#error(e))\n                    return\n                }\n            }\n            const oldIndex = this.#itemIndex\n            while (items[this.#itemIndex + 1]?.begin <= t) this.#itemIndex++\n            if (this.#itemIndex !== oldIndex) this.#highlight()\n        })\n        audio.addEventListener('error', () =>\n            this.#error(new Error(`Failed to load ${src}`)))\n        audio.addEventListener('playing', () => this.#highlight())\n        audio.addEventListener('ended', () => {\n            this.#unhighlight()\n            URL.revokeObjectURL(url)\n            this.#audio = null\n            this.#play(audioIndex + 1, 0).catch(e => this.#error(e))\n        })\n        if (this.#state === 'paused') {\n            this.#highlight()\n            audio.currentTime = this.#activeItem.begin ?? 0\n        }\n        else audio.addEventListener('canplaythrough', () => {\n            // for some reason need to seek in `canplaythrough`\n            // or it won't play when skipping in WebKit\n            audio.currentTime = this.#activeItem.begin ?? 0\n            this.#state = 'playing'\n            audio.play().catch(e => this.#error(e))\n        }, { once: true })\n    }\n    async start(sectionIndex, filter = () => true) {\n        this.#audio?.pause()\n        const section = this.book.sections[sectionIndex]\n        const href = section?.id\n        if (!href) return\n\n        const { mediaOverlay } = section\n        if (!mediaOverlay) return this.start(sectionIndex + 1)\n        this.#sectionIndex = sectionIndex\n        await this.#loadSMIL(mediaOverlay)\n\n        for (let i = 0; i < this.#entries.length; i++) {\n            const { items } = this.#entries[i]\n            for (let j = 0; j < items.length; j++) {\n                if (items[j].text.split('#')[0] === href && filter(items[j], j, items))\n                    return this.#play(i, j).catch(e => this.#error(e))\n            }\n        }\n    }\n    pause() {\n        this.#state = 'paused'\n        this.#audio?.pause()\n    }\n    resume() {\n        this.#state = 'playing'\n        this.#audio?.play().catch(e => this.#error(e))\n    }\n    #stop() {\n        if (this.#audio) {\n            this.#audio.pause()\n            URL.revokeObjectURL(this.#audio.src)\n            this.#audio = null\n            this.#unhighlight()\n        }\n    }\n    stop() {\n        this.#state = 'stopped'\n        this.#stop()\n    }\n    prev() {\n        if (this.#itemIndex > 0) this.#play(this.#audioIndex, this.#itemIndex - 1)\n        else if (this.#audioIndex > 0) this.#play(this.#audioIndex - 1,\n            this.#entries[this.#audioIndex - 1].items.length - 1)\n        else if (this.#sectionIndex > 0)\n            this.start(this.#sectionIndex - 1, (_, i, items) => i === items.length - 1)\n    }\n    next() {\n        this.#play(this.#audioIndex, this.#itemIndex + 1)\n    }\n    setVolume(volume) {\n        this.#volume = volume\n        if (this.#audio) this.#audio.volume = volume\n    }\n    setRate(rate) {\n        this.#rate = rate\n        if (this.#audio) this.#audio.playbackRate = rate\n    }\n}\n\nconst isUUID = /([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/\n\nconst getUUID = opf => {\n    for (const el of opf.getElementsByTagNameNS(NS.DC, 'identifier')) {\n        const [id] = getElementText(el).split(':').slice(-1)\n        if (isUUID.test(id)) return id\n    }\n    return ''\n}\n\nconst getIdentifier = opf => getElementText(\n    opf.getElementById(opf.documentElement.getAttribute('unique-identifier'))\n    ?? opf.getElementsByTagNameNS(NS.DC, 'identifier')[0])\n\n// https://www.w3.org/publishing/epub32/epub-ocf.html#sec-resource-obfuscation\nconst deobfuscate = async (key, length, blob) => {\n    const array = new Uint8Array(await blob.slice(0, length).arrayBuffer())\n    length = Math.min(length, array.length)\n    for (var i = 0; i < length; i++) array[i] = array[i] ^ key[i % key.length]\n    return new Blob([array, blob.slice(length)], { type: blob.type })\n}\n\nconst WebCryptoSHA1 = async str => {\n    const data = new TextEncoder().encode(str)\n    const buffer = await globalThis.crypto.subtle.digest('SHA-1', data)\n    return new Uint8Array(buffer)\n}\n\nconst deobfuscators = (sha1 = WebCryptoSHA1) => ({\n    'http://www.idpf.org/2008/embedding': {\n        key: opf => sha1(getIdentifier(opf)\n            // eslint-disable-next-line no-control-regex\n            .replaceAll(/[\\u0020\\u0009\\u000d\\u000a]/g, '')),\n        decode: (key, blob) => deobfuscate(key, 1040, blob),\n    },\n    'http://ns.adobe.com/pdf/enc#RC': {\n        key: opf => {\n            const uuid = getUUID(opf).replaceAll('-', '')\n            return Uint8Array.from({ length: 16 }, (_, i) =>\n                parseInt(uuid.slice(i * 2, i * 2 + 2), 16))\n        },\n        decode: (key, blob) => deobfuscate(key, 1024, blob),\n    },\n})\n\nclass Encryption {\n    #uris = new Map()\n    #decoders = new Map()\n    #algorithms\n    constructor(algorithms) {\n        this.#algorithms = algorithms\n    }\n    async init(encryption, opf) {\n        if (!encryption) return\n        const data = Array.from(\n            encryption.getElementsByTagNameNS(NS.ENC, 'EncryptedData'), el => ({\n                algorithm: el.getElementsByTagNameNS(NS.ENC, 'EncryptionMethod')[0]\n                    ?.getAttribute('Algorithm'),\n                uri: el.getElementsByTagNameNS(NS.ENC, 'CipherReference')[0]\n                    ?.getAttribute('URI'),\n            }))\n        for (const { algorithm, uri } of data) {\n            if (!this.#decoders.has(algorithm)) {\n                const algo = this.#algorithms[algorithm]\n                if (!algo) {\n                    console.warn('Unknown encryption algorithm')\n                    continue\n                }\n                const key = await algo.key(opf)\n                this.#decoders.set(algorithm, blob => algo.decode(key, blob))\n            }\n            this.#uris.set(uri, algorithm)\n        }\n    }\n    getDecoder(uri) {\n        return this.#decoders.get(this.#uris.get(uri)) ?? (x => x)\n    }\n}\n\nclass Resources {\n    constructor({ opf, resolveHref }) {\n        this.opf = opf\n        const { $, $$, $$$ } = childGetter(opf, NS.OPF)\n\n        const $manifest = $(opf.documentElement, 'manifest')\n        const $spine = $(opf.documentElement, 'spine')\n        const $$itemref = $$($spine, 'itemref')\n\n        this.manifest = $$($manifest, 'item')\n            .map(getAttributes('href', 'id', 'media-type', 'properties', 'media-overlay'))\n            .map(item => {\n                item.href = resolveHref(item.href)\n                item.properties = item.properties?.split(/\\s/)\n                return item\n            })\n        this.manifestById = new Map(this.manifest.map(item => [item.id, item]))\n        this.spine = $$itemref\n            .map(getAttributes('idref', 'id', 'linear', 'properties'))\n            .map(item => (item.properties = item.properties?.split(/\\s/), item))\n        this.pageProgressionDirection = $spine\n            .getAttribute('page-progression-direction')\n\n        this.navPath = this.getItemByProperty('nav')?.href\n        this.ncxPath = (this.getItemByID($spine.getAttribute('toc'))\n            ?? this.manifest.find(item => item.mediaType === MIME.NCX))?.href\n\n        const $guide = $(opf.documentElement, 'guide')\n        if ($guide) this.guide = $$($guide, 'reference')\n            .map(getAttributes('type', 'title', 'href'))\n            .map(({ type, title, href }) => ({\n                label: title,\n                type: type.split(/\\s/),\n                href: resolveHref(href),\n            }))\n\n        this.cover = this.getItemByProperty('cover-image')\n            // EPUB 2 compat\n            ?? this.getItemByID($$$(opf, 'meta')\n                .find(filterAttribute('name', 'cover'))\n                ?.getAttribute('content'))\n            ?? this.getItemByHref(this.guide\n                ?.find(ref => ref.type.includes('cover'))?.href)\n\n        this.cfis = CFI.fromElements($$itemref)\n    }\n    getItemByID(id) {\n        return this.manifestById.get(id)\n    }\n    getItemByHref(href) {\n        return this.manifest.find(item => item.href === href)\n    }\n    getItemByProperty(prop) {\n        return this.manifest.find(item => item.properties?.includes(prop))\n    }\n    resolveCFI(cfi) {\n        const parts = CFI.parse(cfi)\n        const top = (parts.parent ?? parts).shift()\n        let $itemref = CFI.toElement(this.opf, top)\n        // make sure it's an idref; if not, try again without the ID assertion\n        // mainly because Epub.js used to generate wrong ID assertions\n        // https://github.com/futurepress/epub.js/issues/1236\n        if ($itemref && $itemref.nodeName !== 'idref') {\n            top.at(-1).id = null\n            $itemref = CFI.toElement(this.opf, top)\n        }\n        const idref = $itemref?.getAttribute('idref')\n        const index = this.spine.findIndex(item => item.idref === idref)\n        const anchor = doc => CFI.toRange(doc, parts)\n        return { index, anchor }\n    }\n}\n\nclass Loader {\n    #cache = new Map()\n    #children = new Map()\n    #refCount = new Map()\n    allowScript = false\n    eventTarget = new EventTarget()\n    constructor({ loadText, loadBlob, resources }) {\n        this.loadText = loadText\n        this.loadBlob = loadBlob\n        this.manifest = resources.manifest\n        this.assets = resources.manifest\n        // needed only when replacing in (X)HTML w/o parsing (see below)\n        //.filter(({ mediaType }) => ![MIME.XHTML, MIME.HTML].includes(mediaType))\n    }\n    async createURL(href, data, type, parent) {\n        if (!data) return ''\n        const detail = { data, type }\n        Object.defineProperty(detail, 'name', { value: href }) // readonly\n        const event = new CustomEvent('data', { detail })\n        this.eventTarget.dispatchEvent(event)\n        const newData = await event.detail.data\n        const newType = await event.detail.type\n        const url = URL.createObjectURL(new Blob([newData], { type: newType }))\n        this.#cache.set(href, url)\n        this.#refCount.set(href, 1)\n        if (parent) {\n            const childList = this.#children.get(parent)\n            if (childList) childList.push(href)\n            else this.#children.set(parent, [href])\n        }\n        return url\n    }\n    ref(href, parent) {\n        const childList = this.#children.get(parent)\n        if (!childList?.includes(href)) {\n            this.#refCount.set(href, this.#refCount.get(href) + 1)\n            //console.log(`referencing ${href}, now ${this.#refCount.get(href)}`)\n            if (childList) childList.push(href)\n            else this.#children.set(parent, [href])\n        }\n        return this.#cache.get(href)\n    }\n    unref(href) {\n        if (!this.#refCount.has(href)) return\n        const count = this.#refCount.get(href) - 1\n        //console.log(`unreferencing ${href}, now ${count}`)\n        if (count < 1) {\n            //console.log(`unloading ${href}`)\n            URL.revokeObjectURL(this.#cache.get(href))\n            this.#cache.delete(href)\n            this.#refCount.delete(href)\n            // unref children\n            const childList = this.#children.get(href)\n            if (childList) while (childList.length) this.unref(childList.pop())\n            this.#children.delete(href)\n        } else this.#refCount.set(href, count)\n    }\n    // load manifest item, recursively loading all resources as needed\n    async loadItem(item, parents = []) {\n        if (!item) return null\n        const { href, mediaType } = item\n\n        const isScript = MIME.JS.test(item.mediaType)\n        if (isScript && !this.allowScript) return null\n\n        const parent = parents.at(-1)\n        if (this.#cache.has(href)) return this.ref(href, parent)\n\n        const shouldReplace =\n            (isScript || [MIME.XHTML, MIME.HTML, MIME.CSS, MIME.SVG].includes(mediaType))\n            // prevent circular references\n            && parents.every(p => p !== href)\n        if (shouldReplace) return this.loadReplaced(item, parents)\n        // NOTE: this can be replaced with `Promise.try()`\n        const tryLoadBlob = Promise.resolve().then(() => this.loadBlob(href))\n        return this.createURL(href, tryLoadBlob, mediaType, parent)\n    }\n    async loadHref(href, base, parents = []) {\n        if (isExternal(href)) return href\n        const path = resolveURL(href, base)\n        const item = this.manifest.find(item => item.href === path)\n        if (!item) return href\n        return this.loadItem(item, parents.concat(base))\n    }\n    async loadReplaced(item, parents = []) {\n        const { href, mediaType } = item\n        const parent = parents.at(-1)\n        let str = ''\n        try {\n            str = await this.loadText(href)\n        } catch (e) {\n            return this.createURL(href, Promise.reject(e), mediaType, parent)\n        }\n        if (!str) return null\n\n        // note that one can also just use `replaceString` for everything:\n        // ```\n        // const replaced = await this.replaceString(str, href, parents)\n        // return this.createURL(href, replaced, mediaType, parent)\n        // ```\n        // which is basically what Epub.js does, which is simpler, but will\n        // break things like iframes (because you don't want to replace links)\n        // or text that just happen to be paths\n\n        // parse and replace in HTML\n        if ([MIME.XHTML, MIME.HTML, MIME.SVG].includes(mediaType)) {\n            let doc = new DOMParser().parseFromString(str, mediaType)\n            // change to HTML if it's not valid XHTML\n            if (mediaType === MIME.XHTML && (doc.querySelector('parsererror')\n            || !doc.documentElement?.namespaceURI)) {\n                console.warn(doc.querySelector('parsererror')?.innerText ?? 'Invalid XHTML')\n                item.mediaType = MIME.HTML\n                doc = new DOMParser().parseFromString(str, item.mediaType)\n            }\n            // replace hrefs in XML processing instructions\n            // this is mainly for SVGs that use xml-stylesheet\n            if ([MIME.XHTML, MIME.SVG].includes(item.mediaType)) {\n                let child = doc.firstChild\n                while (child instanceof ProcessingInstruction) {\n                    if (child.data) {\n                        const replacedData = await replaceSeries(child.data,\n                            /(?:^|\\s*)(href\\s*=\\s*['\"])([^'\"]*)(['\"])/i,\n                            (_, p1, p2, p3) => this.loadHref(p2, href, parents)\n                                .then(p2 => `${p1}${p2}${p3}`))\n                        child.replaceWith(doc.createProcessingInstruction(\n                            child.target, replacedData))\n                    }\n                    child = child.nextSibling\n                }\n            }\n            // replace hrefs (excluding anchors)\n            // TODO: srcset?\n            const replace = async (el, attr) => el.setAttribute(attr,\n                await this.loadHref(el.getAttribute(attr), href, parents))\n            for (const el of doc.querySelectorAll('link[href]')) await replace(el, 'href')\n            for (const el of doc.querySelectorAll('[src]')) await replace(el, 'src')\n            for (const el of doc.querySelectorAll('[poster]')) await replace(el, 'poster')\n            for (const el of doc.querySelectorAll('object[data]')) await replace(el, 'data')\n            for (const el of doc.querySelectorAll('[*|href]:not([href])'))\n                el.setAttributeNS(NS.XLINK, 'href', await this.loadHref(\n                    el.getAttributeNS(NS.XLINK, 'href'), href, parents))\n            // replace inline styles\n            for (const el of doc.querySelectorAll('style'))\n                if (el.textContent) el.textContent =\n                    await this.replaceCSS(el.textContent, href, parents)\n            for (const el of doc.querySelectorAll('[style]'))\n                el.setAttribute('style',\n                    await this.replaceCSS(el.getAttribute('style'), href, parents))\n            // TODO: replace inline scripts? probably not worth the trouble\n            const result = new XMLSerializer().serializeToString(doc)\n            return this.createURL(href, result, item.mediaType, parent)\n        }\n\n        const result = mediaType === MIME.CSS\n            ? await this.replaceCSS(str, href, parents)\n            : await this.replaceString(str, href, parents)\n        return this.createURL(href, result, mediaType, parent)\n    }\n    async replaceCSS(str, href, parents = []) {\n        const replacedUrls = await replaceSeries(str,\n            /url\\(\\s*[\"']?([^'\"\\n]*?)\\s*[\"']?\\s*\\)/gi,\n            (_, url) => this.loadHref(url, href, parents)\n                .then(url => `url(\"${url}\")`))\n        // apart from `url()`, strings can be used for `@import` (but why?!)\n        return replaceSeries(replacedUrls,\n            /@import\\s*[\"']([^\"'\\n]*?)[\"']/gi,\n            (_, url) => this.loadHref(url, href, parents)\n                .then(url => `@import \"${url}\"`))\n    }\n    // find & replace all possible relative paths for all assets without parsing\n    replaceString(str, href, parents = []) {\n        const assetMap = new Map()\n        const urls = this.assets.map(asset => {\n            // do not replace references to the file itself\n            if (asset.href === href) return\n            // href was decoded and resolved when parsing the manifest\n            const relative = pathRelative(pathDirname(href), asset.href)\n            const relativeEnc = encodeURI(relative)\n            const rootRelative = '/' + asset.href\n            const rootRelativeEnc = encodeURI(rootRelative)\n            const set = new Set([relative, relativeEnc, rootRelative, rootRelativeEnc])\n            for (const url of set) assetMap.set(url, asset)\n            return Array.from(set)\n        }).flat().filter(x => x)\n        if (!urls.length) return str\n        const regex = new RegExp(urls.map(regexEscape).join('|'), 'g')\n        return replaceSeries(str, regex, async match =>\n            this.loadItem(assetMap.get(match.replace(/^\\//, '')),\n                parents.concat(href)))\n    }\n    unloadItem(item) {\n        this.unref(item?.href)\n    }\n    destroy() {\n        for (const url of this.#cache.values()) URL.revokeObjectURL(url)\n    }\n}\n\nconst getHTMLFragment = (doc, id) => doc.getElementById(id)\n    ?? doc.querySelector(`[name=\"${CSS.escape(id)}\"]`)\n\nconst getPageSpread = properties => {\n    for (const p of properties) {\n        if (p === 'page-spread-left' || p === 'rendition:page-spread-left')\n            return 'left'\n        if (p === 'page-spread-right' || p === 'rendition:page-spread-right')\n            return 'right'\n        if (p === 'rendition:page-spread-center') return 'center'\n    }\n}\n\nconst getDisplayOptions = doc => {\n    if (!doc) return null\n    return {\n        fixedLayout: getElementText(doc.querySelector('option[name=\"fixed-layout\"]')),\n        openToSpread: getElementText(doc.querySelector('option[name=\"open-to-spread\"]')),\n    }\n}\n\nexport class EPUB {\n    parser = new DOMParser()\n    #loader\n    #encryption\n    constructor({ loadText, loadBlob, getSize, sha1 }) {\n        this.loadText = loadText\n        this.loadBlob = loadBlob\n        this.getSize = getSize\n        this.#encryption = new Encryption(deobfuscators(sha1))\n    }\n    async #loadXML(uri) {\n        const str = await this.loadText(uri)\n        if (!str) return null\n        const doc = this.parser.parseFromString(str, MIME.XML)\n        if (doc.querySelector('parsererror'))\n            throw new Error(`XML parsing error: ${uri}\n${doc.querySelector('parsererror').innerText}`)\n        return doc\n    }\n    async init() {\n        const $container = await this.#loadXML('META-INF/container.xml')\n        if (!$container) throw new Error('Failed to load container file')\n\n        const opfs = Array.from(\n            $container.getElementsByTagNameNS(NS.CONTAINER, 'rootfile'),\n            getAttributes('full-path', 'media-type'))\n            .filter(file => file.mediaType === 'application/oebps-package+xml')\n\n        if (!opfs.length) throw new Error('No package document defined in container')\n        const opfPath = opfs[0].fullPath\n        const opf = await this.#loadXML(opfPath)\n        if (!opf) throw new Error('Failed to load package document')\n\n        const $encryption = await this.#loadXML('META-INF/encryption.xml')\n        await this.#encryption.init($encryption, opf)\n\n        this.resources = new Resources({\n            opf,\n            resolveHref: url => resolveURL(url, opfPath),\n        })\n        this.#loader = new Loader({\n            loadText: this.loadText,\n            loadBlob: uri => Promise.resolve(this.loadBlob(uri))\n                .then(this.#encryption.getDecoder(uri)),\n            resources: this.resources,\n        })\n        this.transformTarget = this.#loader.eventTarget\n        this.sections = this.resources.spine.map((spineItem, index) => {\n            const { idref, linear, properties = [] } = spineItem\n            const item = this.resources.getItemByID(idref)\n            if (!item) {\n                console.warn(`Could not find item with ID \"${idref}\" in manifest`)\n                return null\n            }\n            return {\n                id: item.href,\n                load: () => this.#loader.loadItem(item),\n                unload: () => this.#loader.unloadItem(item),\n                createDocument: () => this.loadDocument(item),\n                size: this.getSize(item.href),\n                cfi: this.resources.cfis[index],\n                linear,\n                pageSpread: getPageSpread(properties),\n                resolveHref: href => resolveURL(href, item.href),\n                mediaOverlay: item.mediaOverlay\n                    ? this.resources.getItemByID(item.mediaOverlay) : null,\n            }\n        }).filter(s => s)\n\n        const { navPath, ncxPath } = this.resources\n        if (navPath) try {\n            const resolve = url => resolveURL(url, navPath)\n            const nav = parseNav(await this.#loadXML(navPath), resolve)\n            this.toc = nav.toc\n            this.pageList = nav.pageList\n            this.landmarks = nav.landmarks\n        } catch(e) {\n            console.warn(e)\n        }\n        if (!this.toc && ncxPath) try {\n            const resolve = url => resolveURL(url, ncxPath)\n            const ncx = parseNCX(await this.#loadXML(ncxPath), resolve)\n            this.toc = ncx.toc\n            this.pageList = ncx.pageList\n        } catch(e) {\n            console.warn(e)\n        }\n        this.landmarks ??= this.resources.guide\n\n        const { metadata, rendition, media } = getMetadata(opf)\n        this.metadata = metadata\n        this.rendition = rendition\n        this.media = media\n        this.dir = this.resources.pageProgressionDirection\n        const displayOptions = getDisplayOptions(\n            await this.#loadXML('META-INF/com.apple.ibooks.display-options.xml')\n            ?? await this.#loadXML('META-INF/com.kobobooks.display-options.xml'))\n        if (displayOptions) {\n            if (displayOptions.fixedLayout === 'true')\n                this.rendition.layout ??= 'pre-paginated'\n            if (displayOptions.openToSpread === 'false') this.sections\n                .find(section => section.linear !== 'no').pageSpread ??=\n                    this.dir === 'rtl' ? 'left' : 'right'\n        }\n        return this\n    }\n    async loadDocument(item) {\n        const str = await this.loadText(item.href)\n        return this.parser.parseFromString(str, item.mediaType)\n    }\n    getMediaOverlay() {\n        return new MediaOverlay(this, this.#loadXML.bind(this))\n    }\n    resolveCFI(cfi) {\n        return this.resources.resolveCFI(cfi)\n    }\n    resolveHref(href) {\n        const [path, hash] = href.split('#')\n        const item = this.resources.getItemByHref(decodeURI(path))\n        if (!item) return null\n        const index = this.resources.spine.findIndex(({ idref }) => idref === item.id)\n        const anchor = hash ? doc => getHTMLFragment(doc, hash) : () => 0\n        return { index, anchor }\n    }\n    splitTOCHref(href) {\n        return href?.split('#') ?? []\n    }\n    getTOCFragment(doc, id) {\n        return doc.getElementById(id)\n            ?? doc.querySelector(`[name=\"${CSS.escape(id)}\"]`)\n    }\n    isExternal(uri) {\n        return isExternal(uri)\n    }\n    async getCover() {\n        const cover = this.resources?.cover\n        return cover?.href\n            ? new Blob([await this.loadBlob(cover.href)], { type: cover.mediaType })\n            : null\n    }\n    async getCalibreBookmarks() {\n        const txt = await this.loadText('META-INF/calibre_bookmarks.txt')\n        const magic = 'encoding=json+base64:'\n        if (txt?.startsWith(magic)) {\n            const json = atob(txt.slice(magic.length))\n            return JSON.parse(json)\n        }\n    }\n    destroy() {\n        this.#loader?.destroy()\n    }\n}\n"],"names":["NS","MIME","PREFIX","RELATORS","ONIX5","camel","x","_","g","normalizeWhitespace","str","filterAttribute","attr","value","isList","el","getAttributes","xs","getElementText","childGetter","doc","ns","useNS","f","name","resolveURL","url","relativeTo","root","obj","isExternal","uri","pathRelative","from","to","as","bs","i","pathDirname","replaceSeries","regex","matches","args","results","regexEscape","tidy","key","val","keys","getPrefixes","map","prefix","getPropertyURL","prefixes","a","b","reference","baseURL","getMetadata","opf","$","$metadata","els","baseLang","parse","property","scheme","getProperties","refines","dc","properties","legacyMeta","one","prop","p","makeLanguageMap","alts","altRep","y","makeContributor","makeCollection","makeAltIdentifier","type","nid","belongsTo","mainTitle","metadata","getIdentifier","remapContributor","defaultKey","role","rendition","media","parseClock","parseNav","resolve","$$","$$$","resolveHref","href","parseLI","getType","$li","$a","$ol","result","parseOL","$nav","$$nav","toc","pageList","landmarks","others","parseNCX","parseItem","$label","$content","label","parseList","itemName","getSingle","container","$container","parts","h","m","s","unit","n","MediaOverlay","#entries","#lastMediaOverlayItem","#sectionIndex","#audioIndex","#itemIndex","#audio","#volume","#rate","#state","book","loadXML","#loadSMIL","item","arr","$par","text","$audio","src","begin","end","last","#activeAudio","#activeItem","#error","e","#highlight","#unhighlight","#play","audioIndex","itemIndex","#stop","audio","t","items","oldIndex","sectionIndex","filter","section","mediaOverlay","j","volume","rate","isUUID","getUUID","id","deobfuscate","length","blob","array","WebCryptoSHA1","data","buffer","deobfuscators","sha1","uuid","Encryption","#uris","#decoders","#algorithms","algorithms","encryption","algorithm","algo","Resources","$manifest","$spine","$$itemref","$guide","title","ref","CFI.fromElements","cfi","CFI.parse","top","$itemref","CFI.toElement","idref","CFI.toRange","Loader","#cache","#children","#refCount","loadText","loadBlob","resources","parent","detail","event","newData","newType","childList","count","parents","mediaType","isScript","tryLoadBlob","base","path","child","replacedData","p1","p2","p3","replace","replacedUrls","assetMap","urls","asset","relative","relativeEnc","rootRelative","rootRelativeEnc","set","match","getHTMLFragment","getPageSpread","getDisplayOptions","EPUB","#loader","#encryption","getSize","#loadXML","opfs","file","opfPath","$encryption","spineItem","index","linear","navPath","ncxPath","nav","ncx","displayOptions","hash","cover","txt","magic","json"],"mappings":"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","x_google_ignoreList":[0]}