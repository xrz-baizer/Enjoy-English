const y=d=>d?.split(/[,;\s]/)?.filter(t=>t)?.map(t=>t.split("=").map(i=>i.trim())),S=(d,t)=>{if(d.documentElement.localName==="svg"){const[,,n,h]=d.documentElement.getAttribute("viewBox")?.split(/\s/)??[];return{width:n,height:h}}const i=y(d.querySelector('meta[name="viewport"]')?.getAttribute("content"));if(i)return Object.fromEntries(i);if(typeof t=="string")return y(t);if(t?.width&&t.height)return t;const e=d.querySelector("img");return e?{width:e.naturalWidth,height:e.naturalHeight}:(console.warn(new Error("Missing viewport properties")),{width:1e3,height:2e3})};class k extends HTMLElement{static observedAttributes=["zoom"];#a=this.attachShadow({mode:"closed"});#f=new ResizeObserver(()=>this.#e());#i;#h=-1;defaultViewport;spread;#l=!1;#s;#r;#t;#n;#o;constructor(){super();const t=new CSSStyleSheet;this.#a.adoptedStyleSheets=[t],t.replaceSync(`:host {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }`),this.#f.observe(this)}attributeChangedCallback(t,i,e){switch(t){case"zoom":this.#o=e!=="fit-width"&&e!=="fit-page"?parseFloat(e):e,this.#e();break}}async#c({index:t,src:i}){const e=typeof i=="string",n=e?i:i?.src,h=e?null:i?.onZoom,r=document.createElement("div");r.setAttribute("dir","ltr");const o=document.createElement("iframe");return r.append(o),Object.assign(o.style,{border:"0",display:"none",overflow:"hidden"}),o.setAttribute("sandbox","allow-same-origin allow-scripts"),o.setAttribute("scrolling","no"),o.setAttribute("part","filter"),this.#a.append(r),n?new Promise(s=>{o.addEventListener("load",()=>{const c=o.contentDocument;this.dispatchEvent(new CustomEvent("load",{detail:{doc:c,index:t}}));const{width:a,height:l}=S(c,this.defaultViewport);s({element:r,iframe:o,width:parseFloat(a),height:parseFloat(l),onZoom:h})},{once:!0}),o.src=n}):{blank:!0,element:r,iframe:o}}#e(t=this.#n){if(!t)return;const i=this.#s??{},e=this.#t??this.#r??{},n=t==="left"?i:e,{width:h,height:r}=this.getBoundingClientRect(),o=this.spread!=="both"&&this.spread!=="portrait"&&r>h;this.#l=o;const s=i.width??e.width??0,c=i.height??e.height??0,a=typeof this.#o=="number"&&!isNaN(this.#o)?this.#o:(this.#o==="fit-width"?o||this.#t?h/(n.width??s):h/((i.width??s)+(e.width??s)):o||this.#t?Math.min(h/(n.width??s),r/(n.height??c)):Math.min(h/((i.width??s)+(e.width??s)),r/Math.max(i.height??c,e.height??c)))||1,l=g=>{let{element:p,iframe:u,width:m,height:w,blank:x,onZoom:f}=g;if(!u)return;f&&f({doc:g.iframe.contentDocument,scale:a});const b=f?a:1;Object.assign(u.style,{width:`${m*b}px`,height:`${w*b}px`,transform:f?"none":`scale(${a})`,transformOrigin:"top left",display:x?"none":"block"}),Object.assign(p.style,{width:`${(m??s)*a}px`,height:`${(w??c)*a}px`,overflow:"hidden",display:"block",flexShrink:"0",marginBlock:"auto"}),o&&g!==n&&(p.style.display="none")};this.#t?l(this.#t):(l(i),l(e))}async#g({left:t,right:i,center:e,side:n}){this.#a.replaceChildren(),this.#s=null,this.#r=null,this.#t=null,e?(this.#t=await this.#c(e),this.#n="center",this.#e()):(this.#s=await this.#c(t),this.#r=await this.#c(i),this.#n=this.#s.blank?"right":this.#r.blank?"left":n,this.#e())}#p(){if(!(this.#t||this.#s?.blank)&&this.#l&&this.#s?.element?.style?.display==="none")return this.#n="left",this.#e(),this.#d("page"),!0}#u(){if(!(this.#t||this.#r?.blank)&&this.#l&&this.#r?.element?.style?.display==="none")return this.#n="right",this.#e(),this.#d("page"),!0}open(t){this.book=t;const{rendition:i}=t;this.spread=i?.spread,this.defaultViewport=i?.viewport;const e=t.dir==="rtl",n=!e;this.rtl=e,i?.spread==="none"?this.#i=t.sections.map(h=>({center:h})):this.#i=t.sections.reduce((h,r,o)=>{const s=h[h.length-1],{pageSpread:c}=r,a=()=>{const l={};return h.push(l),l};if(c==="center"){const l=s.left||s.right?a():s;l.center=r}else if(c==="left"){const l=s.center||s.left||n&&o?a():s;l.left=r}else if(c==="right"){const l=s.center||s.right||e&&o?a():s;l.right=r}else n?s.center||s.right?a().left=r:s.left||!o?s.right=r:s.left=r:s.center||s.left?a().right=r:s.right||!o?s.left=r:s.right=r;return h},[{}])}get index(){const t=this.#i[this.#h],i=t?.center??(this.#n==="left"?t.left??t.right:t.right??t.left);return this.book.sections.indexOf(i)}#d(t){this.dispatchEvent(new CustomEvent("relocate",{detail:{reason:t,range:null,index:this.index,fraction:0,size:1}}))}getSpreadOf(t){const i=this.#i;for(let e=0;e<i.length;e++){const{left:n,right:h,center:r}=i[e];if(n===t)return{index:e,side:"left"};if(h===t)return{index:e,side:"right"};if(r===t)return{index:e,side:"center"}}}async goToSpread(t,i,e){if(t<0||t>this.#i.length-1)return;if(t===this.#h){this.#e(i);return}this.#h=t;const n=this.#i[t];if(n.center){const h=this.book.sections.indexOf(n.center),r=await n.center?.load?.();await this.#g({center:{index:h,src:r}})}else{const h=this.book.sections.indexOf(n.left),r=this.book.sections.indexOf(n.right),o=await n.left?.load?.(),s=await n.right?.load?.(),c={index:h,src:o},a={index:r,src:s};await this.#g({left:c,right:a,side:i})}this.#d(e)}async select(t){await this.goTo(t)}async goTo(t){const{book:i}=this,e=await t,n=i.sections[e.index];if(!n)return;const{index:h,side:r}=this.getSpreadOf(n);await this.goToSpread(h,r)}async next(){if(!(this.rtl?this.#p():this.#u()))return this.goToSpread(this.#h+1,this.rtl?"right":"left","page")}async prev(){if(!(this.rtl?this.#u():this.#p()))return this.goToSpread(this.#h-1,this.rtl?"left":"right","page")}getContents(){return Array.from(this.#a.querySelectorAll("iframe"),t=>({doc:t.contentDocument}))}destroy(){this.#f.unobserve(this)}}customElements.define("foliate-fxl",k);export{k as FixedLayout};
//# sourceMappingURL=fixed-layout-D4c9WMmo.js.map
