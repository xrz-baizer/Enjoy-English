{"version":3,"file":"fixed-layout-D4c9WMmo.js","sources":["../../../../node_modules/foliate-js/fixed-layout.js"],"sourcesContent":["const parseViewport = str => str\n    ?.split(/[,;\\s]/) // NOTE: technically, only the comma is valid\n    ?.filter(x => x)\n    ?.map(x => x.split('=').map(x => x.trim()))\n\nconst getViewport = (doc, viewport) => {\n    // use `viewBox` for SVG\n    if (doc.documentElement.localName === 'svg') {\n        const [, , width, height] = doc.documentElement\n            .getAttribute('viewBox')?.split(/\\s/) ?? []\n        return { width, height }\n    }\n\n    // get `viewport` `meta` element\n    const meta = parseViewport(doc.querySelector('meta[name=\"viewport\"]')\n        ?.getAttribute('content'))\n    if (meta) return Object.fromEntries(meta)\n\n    // fallback to book's viewport\n    if (typeof viewport === 'string') return parseViewport(viewport)\n    if (viewport?.width && viewport.height) return viewport\n\n    // if no viewport (possibly with image directly in spine), get image size\n    const img = doc.querySelector('img')\n    if (img) return { width: img.naturalWidth, height: img.naturalHeight }\n\n    // just show *something*, i guess...\n    console.warn(new Error('Missing viewport properties'))\n    return { width: 1000, height: 2000 }\n}\n\nexport class FixedLayout extends HTMLElement {\n    static observedAttributes = ['zoom']\n    #root = this.attachShadow({ mode: 'closed' })\n    #observer = new ResizeObserver(() => this.#render())\n    #spreads\n    #index = -1\n    defaultViewport\n    spread\n    #portrait = false\n    #left\n    #right\n    #center\n    #side\n    #zoom\n    constructor() {\n        super()\n\n        const sheet = new CSSStyleSheet()\n        this.#root.adoptedStyleSheets = [sheet]\n        sheet.replaceSync(`:host {\n            width: 100%;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            overflow: auto;\n        }`)\n\n        this.#observer.observe(this)\n    }\n    attributeChangedCallback(name, _, value) {\n        switch (name) {\n            case 'zoom':\n                this.#zoom = value !== 'fit-width' && value !== 'fit-page'\n                    ? parseFloat(value) : value\n                this.#render()\n                break\n        }\n    }\n    async #createFrame({ index, src: srcOption }) {\n        const srcOptionIsString = typeof srcOption === 'string'\n        const src = srcOptionIsString ? srcOption : srcOption?.src\n        const onZoom = srcOptionIsString ? null : srcOption?.onZoom\n        const element = document.createElement('div')\n        element.setAttribute('dir', 'ltr')\n        const iframe = document.createElement('iframe')\n        element.append(iframe)\n        Object.assign(iframe.style, {\n            border: '0',\n            display: 'none',\n            overflow: 'hidden',\n        })\n        // `allow-scripts` is needed for events because of WebKit bug\n        // https://bugs.webkit.org/show_bug.cgi?id=218086\n        iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts')\n        iframe.setAttribute('scrolling', 'no')\n        iframe.setAttribute('part', 'filter')\n        this.#root.append(element)\n        if (!src) return { blank: true, element, iframe }\n        return new Promise(resolve => {\n            iframe.addEventListener('load', () => {\n                const doc = iframe.contentDocument\n                this.dispatchEvent(new CustomEvent('load', { detail: { doc, index } }))\n                const { width, height } = getViewport(doc, this.defaultViewport)\n                resolve({\n                    element, iframe,\n                    width: parseFloat(width),\n                    height: parseFloat(height),\n                    onZoom,\n                })\n            }, { once: true })\n            iframe.src = src\n        })\n    }\n    #render(side = this.#side) {\n        if (!side) return\n        const left = this.#left ?? {}\n        const right = this.#center ?? this.#right ?? {}\n        const target = side === 'left' ? left : right\n        const { width, height } = this.getBoundingClientRect()\n        const portrait = this.spread !== 'both' && this.spread !== 'portrait'\n            && height > width\n        this.#portrait = portrait\n        const blankWidth = left.width ?? right.width ?? 0\n        const blankHeight = left.height ?? right.height ?? 0\n\n        const scale = typeof this.#zoom === 'number' && !isNaN(this.#zoom)\n            ? this.#zoom\n            : (this.#zoom === 'fit-width'\n                ? (portrait || this.#center\n                    ? width / (target.width ?? blankWidth)\n                    : width / ((left.width ?? blankWidth) + (right.width ?? blankWidth)))\n                : (portrait || this.#center\n                    ? Math.min(\n                        width / (target.width ?? blankWidth),\n                        height / (target.height ?? blankHeight))\n                    : Math.min(\n                        width / ((left.width ?? blankWidth) + (right.width ?? blankWidth)),\n                        height / Math.max(\n                            left.height ?? blankHeight,\n                            right.height ?? blankHeight)))\n            ) || 1\n\n        const transform = frame => {\n            let { element, iframe, width, height, blank, onZoom } = frame\n            if (!iframe) return\n            if (onZoom) onZoom({ doc: frame.iframe.contentDocument, scale })\n            const iframeScale = onZoom ? scale : 1\n            Object.assign(iframe.style, {\n                width: `${width * iframeScale}px`,\n                height: `${height * iframeScale}px`,\n                transform: onZoom ? 'none' : `scale(${scale})`,\n                transformOrigin: 'top left',\n                display: blank ? 'none' : 'block',\n            })\n            Object.assign(element.style, {\n                width: `${(width ?? blankWidth) * scale}px`,\n                height: `${(height ?? blankHeight) * scale}px`,\n                overflow: 'hidden',\n                display: 'block',\n                flexShrink: '0',\n                marginBlock: 'auto',\n            })\n            if (portrait && frame !== target) {\n                element.style.display = 'none'\n            }\n        }\n        if (this.#center) {\n            transform(this.#center)\n        } else {\n            transform(left)\n            transform(right)\n        }\n    }\n    async #showSpread({ left, right, center, side }) {\n        this.#root.replaceChildren()\n        this.#left = null\n        this.#right = null\n        this.#center = null\n        if (center) {\n            this.#center = await this.#createFrame(center)\n            this.#side = 'center'\n            this.#render()\n        } else {\n            this.#left = await this.#createFrame(left)\n            this.#right = await this.#createFrame(right)\n            this.#side = this.#left.blank ? 'right'\n                : this.#right.blank ? 'left' : side\n            this.#render()\n        }\n    }\n    #goLeft() {\n        if (this.#center || this.#left?.blank) return\n        if (this.#portrait && this.#left?.element?.style?.display === 'none') {\n            this.#side = 'left'\n            this.#render()\n            this.#reportLocation('page')\n            return true\n        }\n    }\n    #goRight() {\n        if (this.#center || this.#right?.blank) return\n        if (this.#portrait && this.#right?.element?.style?.display === 'none') {\n            this.#side = 'right'\n            this.#render()\n            this.#reportLocation('page')\n            return true\n        }\n    }\n    open(book) {\n        this.book = book\n        const { rendition } = book\n        this.spread = rendition?.spread\n        this.defaultViewport = rendition?.viewport\n\n        const rtl = book.dir === 'rtl'\n        const ltr = !rtl\n        this.rtl = rtl\n\n        if (rendition?.spread === 'none')\n            this.#spreads = book.sections.map(section => ({ center: section }))\n        else this.#spreads = book.sections.reduce((arr, section, i) => {\n            const last = arr[arr.length - 1]\n            const { pageSpread } = section\n            const newSpread = () => {\n                const spread = {}\n                arr.push(spread)\n                return spread\n            }\n            if (pageSpread === 'center') {\n                const spread = last.left || last.right ? newSpread() : last\n                spread.center = section\n            }\n            else if (pageSpread === 'left') {\n                const spread = last.center || last.left || ltr && i ? newSpread() : last\n                spread.left = section\n            }\n            else if (pageSpread === 'right') {\n                const spread = last.center || last.right || rtl && i ? newSpread() : last\n                spread.right = section\n            }\n            else if (ltr) {\n                if (last.center || last.right) newSpread().left = section\n                else if (last.left || !i) last.right = section\n                else last.left = section\n            }\n            else {\n                if (last.center || last.left) newSpread().right = section\n                else if (last.right || !i) last.left = section\n                else last.right = section\n            }\n            return arr\n        }, [{}])\n    }\n    get index() {\n        const spread = this.#spreads[this.#index]\n        const section = spread?.center ?? (this.#side === 'left'\n            ? spread.left ?? spread.right : spread.right ?? spread.left)\n        return this.book.sections.indexOf(section)\n    }\n    #reportLocation(reason) {\n        this.dispatchEvent(new CustomEvent('relocate', { detail:\n            { reason, range: null, index: this.index, fraction: 0, size: 1 } }))\n    }\n    getSpreadOf(section) {\n        const spreads = this.#spreads\n        for (let index = 0; index < spreads.length; index++) {\n            const { left, right, center } = spreads[index]\n            if (left === section) return { index, side: 'left' }\n            if (right === section) return { index, side: 'right' }\n            if (center === section) return { index, side: 'center' }\n        }\n    }\n    async goToSpread(index, side, reason) {\n        if (index < 0 || index > this.#spreads.length - 1) return\n        if (index === this.#index) {\n            this.#render(side)\n            return\n        }\n        this.#index = index\n        const spread = this.#spreads[index]\n        if (spread.center) {\n            const index = this.book.sections.indexOf(spread.center)\n            const src = await spread.center?.load?.()\n            await this.#showSpread({ center: { index, src } })\n        } else {\n            const indexL = this.book.sections.indexOf(spread.left)\n            const indexR = this.book.sections.indexOf(spread.right)\n            const srcL = await spread.left?.load?.()\n            const srcR = await spread.right?.load?.()\n            const left = { index: indexL, src: srcL }\n            const right = { index: indexR, src: srcR }\n            await this.#showSpread({ left, right, side })\n        }\n        this.#reportLocation(reason)\n    }\n    async select(target) {\n        await this.goTo(target)\n        // TODO\n    }\n    async goTo(target) {\n        const { book } = this\n        const resolved = await target\n        const section = book.sections[resolved.index]\n        if (!section) return\n        const { index, side } = this.getSpreadOf(section)\n        await this.goToSpread(index, side)\n    }\n    async next() {\n        const s = this.rtl ? this.#goLeft() : this.#goRight()\n        if (!s) return this.goToSpread(this.#index + 1, this.rtl ? 'right' : 'left', 'page')\n    }\n    async prev() {\n        const s = this.rtl ? this.#goRight() : this.#goLeft()\n        if (!s) return this.goToSpread(this.#index - 1, this.rtl ? 'left' : 'right', 'page')\n    }\n    getContents() {\n        return Array.from(this.#root.querySelectorAll('iframe'), frame => ({\n            doc: frame.contentDocument,\n            // TODO: index, overlayer\n        }))\n    }\n    destroy() {\n        this.#observer.unobserve(this)\n    }\n}\n\ncustomElements.define('foliate-fxl', FixedLayout)\n"],"names":["parseViewport","str","x","getViewport","doc","viewport","width","height","meta","img","FixedLayout","#root","#observer","#render","#spreads","#index","#portrait","#left","#right","#center","#side","#zoom","sheet","name","_","value","#createFrame","index","srcOption","srcOptionIsString","src","onZoom","element","iframe","resolve","side","left","right","target","portrait","blankWidth","blankHeight","scale","transform","frame","blank","iframeScale","#showSpread","center","#goLeft","#reportLocation","#goRight","book","rendition","rtl","ltr","section","arr","i","last","pageSpread","newSpread","spread","reason","spreads","indexL","indexR","srcL","srcR","resolved"],"mappings":"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","x_google_ignoreList":[0]}