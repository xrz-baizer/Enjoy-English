{"version":3,"file":"paginator-9XPPhfst.js","sources":["../../../../node_modules/foliate-js/paginator.js"],"sourcesContent":["const wait = ms => new Promise(resolve => setTimeout(resolve, ms))\n\nconst debounce = (f, wait, immediate) => {\n    let timeout\n    return (...args) => {\n        const later = () => {\n            timeout = null\n            if (!immediate) f(...args)\n        }\n        const callNow = immediate && !timeout\n        if (timeout) clearTimeout(timeout)\n        timeout = setTimeout(later, wait)\n        if (callNow) f(...args)\n    }\n}\n\nconst lerp = (min, max, x) => x * (max - min) + min\nconst easeOutQuad = x => 1 - (1 - x) * (1 - x)\nconst animate = (a, b, duration, ease, render) => new Promise(resolve => {\n    let start\n    const step = now => {\n        start ??= now\n        const fraction = Math.min(1, (now - start) / duration)\n        render(lerp(a, b, ease(fraction)))\n        if (fraction < 1) requestAnimationFrame(step)\n        else resolve()\n    }\n    requestAnimationFrame(step)\n})\n\n// collapsed range doesn't return client rects sometimes (or always?)\n// try make get a non-collapsed range or element\nconst uncollapse = range => {\n    if (!range?.collapsed) return range\n    const { endOffset, endContainer } = range\n    if (endContainer.nodeType === 1) {\n        const node = endContainer.childNodes[endOffset]\n        if (node?.nodeType === 1) return node\n        return endContainer\n    }\n    if (endOffset + 1 < endContainer.length) range.setEnd(endContainer, endOffset + 1)\n    else if (endOffset > 1) range.setStart(endContainer, endOffset - 1)\n    else return endContainer.parentNode\n    return range\n}\n\nconst makeRange = (doc, node, start, end = start) => {\n    const range = doc.createRange()\n    range.setStart(node, start)\n    range.setEnd(node, end)\n    return range\n}\n\n// use binary search to find an offset value in a text node\nconst bisectNode = (doc, node, cb, start = 0, end = node.nodeValue.length) => {\n    if (end - start === 1) {\n        const result = cb(makeRange(doc, node, start), makeRange(doc, node, end))\n        return result < 0 ? start : end\n    }\n    const mid = Math.floor(start + (end - start) / 2)\n    const result = cb(makeRange(doc, node, start, mid), makeRange(doc, node, mid, end))\n    return result < 0 ? bisectNode(doc, node, cb, start, mid)\n        : result > 0 ? bisectNode(doc, node, cb, mid, end) : mid\n}\n\nconst { SHOW_ELEMENT, SHOW_TEXT, SHOW_CDATA_SECTION,\n    FILTER_ACCEPT, FILTER_REJECT, FILTER_SKIP } = NodeFilter\n\nconst filter = SHOW_ELEMENT | SHOW_TEXT | SHOW_CDATA_SECTION\n\n// needed cause there seems to be a bug in `getBoundingClientRect()` in Firefox\n// where it fails to include rects that have zero width and non-zero height\n// (CSSOM spec says \"rectangles [...] of which the height or width is not zero\")\n// which makes the visible range include an extra space at column boundaries\nconst getBoundingClientRect = target => {\n    let top = Infinity, right = -Infinity, left = Infinity, bottom = -Infinity\n    for (const rect of target.getClientRects()) {\n        left = Math.min(left, rect.left)\n        top = Math.min(top, rect.top)\n        right = Math.max(right, rect.right)\n        bottom = Math.max(bottom, rect.bottom)\n    }\n    return new DOMRect(left, top, right - left, bottom - top)\n}\n\nconst getVisibleRange = (doc, start, end, mapRect) => {\n    // first get all visible nodes\n    const acceptNode = node => {\n        const name = node.localName?.toLowerCase()\n        // ignore all scripts, styles, and their children\n        if (name === 'script' || name === 'style') return FILTER_REJECT\n        if (node.nodeType === 1) {\n            const { left, right } = mapRect(node.getBoundingClientRect())\n            // no need to check child nodes if it's completely out of view\n            if (right < start || left > end) return FILTER_REJECT\n            // elements must be completely in view to be considered visible\n            // because you can't specify offsets for elements\n            if (left >= start && right <= end) return FILTER_ACCEPT\n            // TODO: it should probably allow elements that do not contain text\n            // because they can exceed the whole viewport in both directions\n            // especially in scrolled mode\n        } else {\n            // ignore empty text nodes\n            if (!node.nodeValue?.trim()) return FILTER_SKIP\n            // create range to get rect\n            const range = doc.createRange()\n            range.selectNodeContents(node)\n            const { left, right } = mapRect(range.getBoundingClientRect())\n            // it's visible if any part of it is in view\n            if (right >= start && left <= end) return FILTER_ACCEPT\n        }\n        return FILTER_SKIP\n    }\n    const walker = doc.createTreeWalker(doc.body, filter, { acceptNode })\n    const nodes = []\n    for (let node = walker.nextNode(); node; node = walker.nextNode())\n        nodes.push(node)\n\n    // we're only interested in the first and last visible nodes\n    const from = nodes[0] ?? doc.body\n    const to = nodes[nodes.length - 1] ?? from\n\n    // find the offset at which visibility changes\n    const startOffset = from.nodeType === 1 ? 0\n        : bisectNode(doc, from, (a, b) => {\n            const p = mapRect(getBoundingClientRect(a))\n            const q = mapRect(getBoundingClientRect(b))\n            if (p.right < start && q.left > start) return 0\n            return q.left > start ? -1 : 1\n        })\n    const endOffset = to.nodeType === 1 ? 0\n        : bisectNode(doc, to, (a, b) => {\n            const p = mapRect(getBoundingClientRect(a))\n            const q = mapRect(getBoundingClientRect(b))\n            if (p.right < end && q.left > end) return 0\n            return q.left > end ? -1 : 1\n        })\n\n    const range = doc.createRange()\n    range.setStart(from, startOffset)\n    range.setEnd(to, endOffset)\n    return range\n}\n\nconst selectionIsBackward = sel => {\n    const range = document.createRange()\n    range.setStart(sel.anchorNode, sel.anchorOffset)\n    range.setEnd(sel.focusNode, sel.focusOffset)\n    return range.collapsed\n}\n\nconst setSelectionTo = (target, collapse) => {\n    let range\n    if (target.startContainer) range = target.cloneRange()\n    else if (target.nodeType) {\n        range = document.createRange()\n        range.selectNode(target)\n    }\n    if (range) {\n        const sel = range.startContainer.ownerDocument.defaultView.getSelection()\n        if (sel) {\n            sel.removeAllRanges()\n            if (collapse === -1) range.collapse(true)\n            else if (collapse === 1) range.collapse()\n            sel.addRange(range)\n        }\n    }\n}\n\nconst getDirection = doc => {\n    const { defaultView } = doc\n    const { writingMode, direction } = defaultView.getComputedStyle(doc.body)\n    const vertical = writingMode === 'vertical-rl'\n        || writingMode === 'vertical-lr'\n    const rtl = doc.body.dir === 'rtl'\n        || direction === 'rtl'\n        || doc.documentElement.dir === 'rtl'\n    return { vertical, rtl }\n}\n\nconst getBackground = doc => {\n    const bodyStyle = doc.defaultView.getComputedStyle(doc.body)\n    return bodyStyle.backgroundColor === 'rgba(0, 0, 0, 0)'\n        && bodyStyle.backgroundImage === 'none'\n        ? doc.defaultView.getComputedStyle(doc.documentElement).background\n        : bodyStyle.background\n}\n\nconst makeMarginals = (length, part) => Array.from({ length }, () => {\n    const div = document.createElement('div')\n    const child = document.createElement('div')\n    div.append(child)\n    child.setAttribute('part', part)\n    return div\n})\n\nconst setStylesImportant = (el, styles) => {\n    const { style } = el\n    for (const [k, v] of Object.entries(styles)) style.setProperty(k, v, 'important')\n}\n\nclass View {\n    #observer = new ResizeObserver(() => this.expand())\n    #element = document.createElement('div')\n    #iframe = document.createElement('iframe')\n    #contentRange = document.createRange()\n    #overlayer\n    #vertical = false\n    #rtl = false\n    #column = true\n    #size\n    #layout = {}\n    constructor({ container, onExpand }) {\n        this.container = container\n        this.onExpand = onExpand\n        this.#iframe.setAttribute('part', 'filter')\n        this.#element.append(this.#iframe)\n        Object.assign(this.#element.style, {\n            boxSizing: 'content-box',\n            position: 'relative',\n            overflow: 'hidden',\n            flex: '0 0 auto',\n            width: '100%', height: '100%',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n        })\n        Object.assign(this.#iframe.style, {\n            overflow: 'hidden',\n            border: '0',\n            display: 'none',\n            width: '100%', height: '100%',\n        })\n        // `allow-scripts` is needed for events because of WebKit bug\n        // https://bugs.webkit.org/show_bug.cgi?id=218086\n        this.#iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts')\n        this.#iframe.setAttribute('scrolling', 'no')\n    }\n    get element() {\n        return this.#element\n    }\n    get document() {\n        return this.#iframe.contentDocument\n    }\n    async load(src, afterLoad, beforeRender) {\n        if (typeof src !== 'string') throw new Error(`${src} is not string`)\n        return new Promise(resolve => {\n            this.#iframe.addEventListener('load', () => {\n                const doc = this.document\n                afterLoad?.(doc)\n\n                // it needs to be visible for Firefox to get computed style\n                this.#iframe.style.display = 'block'\n                const { vertical, rtl } = getDirection(doc)\n                const background = getBackground(doc)\n                this.#iframe.style.display = 'none'\n\n                this.#vertical = vertical\n                this.#rtl = rtl\n\n                this.#contentRange.selectNodeContents(doc.body)\n                const layout = beforeRender?.({ vertical, rtl, background })\n                this.#iframe.style.display = 'block'\n                this.render(layout)\n                this.#observer.observe(doc.body)\n\n                // the resize observer above doesn't work in Firefox\n                // (see https://bugzilla.mozilla.org/show_bug.cgi?id=1832939)\n                // until the bug is fixed we can at least account for font load\n                doc.fonts.ready.then(() => this.expand())\n\n                resolve()\n            }, { once: true })\n            this.#iframe.src = src\n        })\n    }\n    render(layout) {\n        if (!layout) return\n        this.#column = layout.flow !== 'scrolled'\n        this.#layout = layout\n        if (this.#column) this.columnize(layout)\n        else this.scrolled(layout)\n    }\n    scrolled({ gap, columnWidth }) {\n        const vertical = this.#vertical\n        const doc = this.document\n        setStylesImportant(doc.documentElement, {\n            'box-sizing': 'border-box',\n            'padding': vertical ? `${gap}px 0` : `0 ${gap}px`,\n            'column-width': 'auto',\n            'height': 'auto',\n            'width': 'auto',\n        })\n        setStylesImportant(doc.body, {\n            [vertical ? 'max-height' : 'max-width']: `${columnWidth}px`,\n            'margin': 'auto',\n        })\n        this.setImageSize()\n        this.expand()\n    }\n    columnize({ width, height, gap, columnWidth }) {\n        const vertical = this.#vertical\n        this.#size = vertical ? height : width\n\n        const doc = this.document\n        setStylesImportant(doc.documentElement, {\n            'box-sizing': 'border-box',\n            'column-width': `${Math.trunc(columnWidth)}px`,\n            'column-gap': `${gap}px`,\n            'column-fill': 'auto',\n            ...(vertical\n                ? { 'width': `${width}px` }\n                : { 'height': `${height}px` }),\n            'padding': vertical ? `${gap / 2}px 0` : `0 ${gap / 2}px`,\n            'overflow': 'hidden',\n            // force wrap long words\n            'overflow-wrap': 'break-word',\n            // reset some potentially problematic props\n            'position': 'static', 'border': '0', 'margin': '0',\n            'max-height': 'none', 'max-width': 'none',\n            'min-height': 'none', 'min-width': 'none',\n            // fix glyph clipping in WebKit\n            '-webkit-line-box-contain': 'block glyphs replaced',\n        })\n        setStylesImportant(doc.body, {\n            'max-height': 'none',\n            'max-width': 'none',\n            'margin': '0',\n        })\n        this.setImageSize()\n        this.expand()\n    }\n    setImageSize() {\n        const { width, height, margin } = this.#layout\n        const vertical = this.#vertical\n        const doc = this.document\n        for (const el of doc.body.querySelectorAll('img, svg, video')) {\n            // preserve max size if they are already set\n            const { maxHeight, maxWidth } = doc.defaultView.getComputedStyle(el)\n            setStylesImportant(el, {\n                'max-height': vertical\n                    ? (maxHeight !== 'none' && maxHeight !== '0px' ? maxHeight : '100%')\n                    : `${height - margin * 2}px`,\n                'max-width': vertical\n                    ? `${width - margin * 2}px`\n                    : (maxWidth !== 'none' && maxWidth !== '0px' ? maxWidth : '100%'),\n                'object-fit': 'contain',\n                'page-break-inside': 'avoid',\n                'break-inside': 'avoid',\n                'box-sizing': 'border-box',\n            })\n        }\n    }\n    expand() {\n        const { documentElement } = this.document\n        if (this.#column) {\n            const side = this.#vertical ? 'height' : 'width'\n            const otherSide = this.#vertical ? 'width' : 'height'\n            const contentRect = this.#contentRange.getBoundingClientRect()\n            const rootRect = documentElement.getBoundingClientRect()\n            // offset caused by column break at the start of the page\n            // which seem to be supported only by WebKit and only for horizontal writing\n            const contentStart = this.#vertical ? 0\n                : this.#rtl ? rootRect.right - contentRect.right : contentRect.left - rootRect.left\n            const contentSize = contentStart + contentRect[side]\n            const pageCount = Math.ceil(contentSize / this.#size)\n            const expandedSize = pageCount * this.#size\n            this.#element.style.padding = '0'\n            this.#iframe.style[side] = `${expandedSize}px`\n            this.#element.style[side] = `${expandedSize + this.#size * 2}px`\n            this.#iframe.style[otherSide] = '100%'\n            this.#element.style[otherSide] = '100%'\n            documentElement.style[side] = `${this.#size}px`\n            if (this.#overlayer) {\n                this.#overlayer.element.style.margin = '0'\n                this.#overlayer.element.style.left = this.#vertical ? '0' : `${this.#size}px`\n                this.#overlayer.element.style.top = this.#vertical ? `${this.#size}px` : '0'\n                this.#overlayer.element.style[side] = `${expandedSize}px`\n                this.#overlayer.redraw()\n            }\n        } else {\n            const side = this.#vertical ? 'width' : 'height'\n            const otherSide = this.#vertical ? 'height' : 'width'\n            const contentSize = documentElement.getBoundingClientRect()[side]\n            const expandedSize = contentSize\n            const { margin } = this.#layout\n            const padding = this.#vertical ? `0 ${margin}px` : `${margin}px 0`\n            this.#element.style.padding = padding\n            this.#iframe.style[side] = `${expandedSize}px`\n            this.#element.style[side] = `${expandedSize}px`\n            this.#iframe.style[otherSide] = '100%'\n            this.#element.style[otherSide] = '100%'\n            if (this.#overlayer) {\n                this.#overlayer.element.style.margin = padding\n                this.#overlayer.element.style.left = '0'\n                this.#overlayer.element.style.top = '0'\n                this.#overlayer.element.style[side] = `${expandedSize}px`\n                this.#overlayer.redraw()\n            }\n        }\n        this.onExpand()\n    }\n    set overlayer(overlayer) {\n        this.#overlayer = overlayer\n        this.#element.append(overlayer.element)\n    }\n    get overlayer() {\n        return this.#overlayer\n    }\n    destroy() {\n        if (this.document) this.#observer.unobserve(this.document.body)\n    }\n}\n\n// NOTE: everything here assumes the so-called \"negative scroll type\" for RTL\nexport class Paginator extends HTMLElement {\n    static observedAttributes = [\n        'flow', 'gap', 'margin',\n        'max-inline-size', 'max-block-size', 'max-column-count',\n    ]\n    #root = this.attachShadow({ mode: 'closed' })\n    #observer = new ResizeObserver(() => this.render())\n    #top\n    #background\n    #container\n    #header\n    #footer\n    #view\n    #vertical = false\n    #rtl = false\n    #margin = 0\n    #index = -1\n    #anchor = 0 // anchor view to a fraction (0-1), Range, or Element\n    #justAnchored = false\n    #locked = false // while true, prevent any further navigation\n    #styles\n    #styleMap = new WeakMap()\n    #mediaQuery = matchMedia('(prefers-color-scheme: dark)')\n    #mediaQueryListener\n    #scrollBounds\n    #touchState\n    #touchScrolled\n    #lastVisibleRange\n    constructor() {\n        super()\n        this.#root.innerHTML = `<style>\n        :host {\n            display: block;\n            container-type: size;\n        }\n        :host, #top {\n            box-sizing: border-box;\n            position: relative;\n            overflow: hidden;\n            width: 100%;\n            height: 100%;\n        }\n        #top {\n            --_gap: 7%;\n            --_margin: 48px;\n            --_max-inline-size: 720px;\n            --_max-block-size: 1440px;\n            --_max-column-count: 2;\n            --_max-column-count-portrait: 1;\n            --_max-column-count-spread: var(--_max-column-count);\n            --_half-gap: calc(var(--_gap) / 2);\n            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));\n            --_max-height: var(--_max-block-size);\n            display: grid;\n            grid-template-columns:\n                minmax(var(--_half-gap), 1fr)\n                var(--_half-gap)\n                minmax(0, calc(var(--_max-width) - var(--_gap)))\n                var(--_half-gap)\n                minmax(var(--_half-gap), 1fr);\n            grid-template-rows:\n                minmax(var(--_margin), 1fr)\n                minmax(0, var(--_max-height))\n                minmax(var(--_margin), 1fr);\n            &.vertical {\n                --_max-column-count-spread: var(--_max-column-count-portrait);\n                --_max-width: var(--_max-block-size);\n                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));\n            }\n            @container (orientation: portrait) {\n                & {\n                    --_max-column-count-spread: var(--_max-column-count-portrait);\n                }\n                &.vertical {\n                    --_max-column-count-spread: var(--_max-column-count);\n                }\n            }\n        }\n        #background {\n            grid-column: 1 / -1;\n            grid-row: 1 / -1;\n        }\n        #container {\n            grid-column: 2 / 5;\n            grid-row: 2;\n            overflow: hidden;\n        }\n        :host([flow=\"scrolled\"]) #container {\n            grid-column: 1 / -1;\n            grid-row: 1 / -1;\n            overflow: auto;\n        }\n        #header {\n            grid-column: 3 / 4;\n            grid-row: 1;\n        }\n        #footer {\n            grid-column: 3 / 4;\n            grid-row: 3;\n            align-self: end;\n        }\n        #header, #footer {\n            display: grid;\n            height: var(--_margin);\n        }\n        :is(#header, #footer) > * {\n            display: flex;\n            align-items: center;\n            min-width: 0;\n        }\n        :is(#header, #footer) > * > * {\n            width: 100%;\n            overflow: hidden;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            text-align: center;\n            font-size: .75em;\n            opacity: .6;\n        }\n        </style>\n        <div id=\"top\">\n            <div id=\"background\" part=\"filter\"></div>\n            <div id=\"header\"></div>\n            <div id=\"container\"></div>\n            <div id=\"footer\"></div>\n        </div>\n        `\n\n        this.#top = this.#root.getElementById('top')\n        this.#background = this.#root.getElementById('background')\n        this.#container = this.#root.getElementById('container')\n        this.#header = this.#root.getElementById('header')\n        this.#footer = this.#root.getElementById('footer')\n\n        this.#observer.observe(this.#container)\n        this.#container.addEventListener('scroll', () => this.dispatchEvent(new Event('scroll')))\n        this.#container.addEventListener('scroll', debounce(() => {\n            if (this.scrolled) {\n                if (this.#justAnchored) this.#justAnchored = false\n                else this.#afterScroll('scroll')\n            }\n        }, 250))\n\n        const opts = { passive: false }\n        this.addEventListener('touchstart', this.#onTouchStart.bind(this), opts)\n        this.addEventListener('touchmove', this.#onTouchMove.bind(this), opts)\n        this.addEventListener('touchend', this.#onTouchEnd.bind(this))\n        this.addEventListener('load', ({ detail: { doc } }) => {\n            doc.addEventListener('touchstart', this.#onTouchStart.bind(this), opts)\n            doc.addEventListener('touchmove', this.#onTouchMove.bind(this), opts)\n            doc.addEventListener('touchend', this.#onTouchEnd.bind(this))\n        })\n\n        this.addEventListener('relocate', ({ detail }) => {\n            if (detail.reason === 'selection') setSelectionTo(this.#anchor, 0)\n            else if (detail.reason === 'navigation') {\n                if (this.#anchor === 1) setSelectionTo(detail.range, 1)\n                else if (typeof this.#anchor === 'number')\n                    setSelectionTo(detail.range, -1)\n                else setSelectionTo(this.#anchor, -1)\n            }\n        })\n        const checkPointerSelection = debounce((range, sel) => {\n            if (!sel.rangeCount) return\n            const selRange = sel.getRangeAt(0)\n            const backward = selectionIsBackward(sel)\n            if (backward && selRange.compareBoundaryPoints(Range.START_TO_START, range) < 0)\n                this.prev()\n            else if (!backward && selRange.compareBoundaryPoints(Range.END_TO_END, range) > 0)\n                this.next()\n        }, 700)\n        this.addEventListener('load', ({ detail: { doc } }) => {\n            let isPointerSelecting = false\n            doc.addEventListener('pointerdown', () => isPointerSelecting = true)\n            doc.addEventListener('pointerup', () => isPointerSelecting = false)\n            let isKeyboardSelecting = false\n            doc.addEventListener('keydown', () => isKeyboardSelecting = true)\n            doc.addEventListener('keyup', () => isKeyboardSelecting = false)\n            doc.addEventListener('selectionchange', () => {\n                if (this.scrolled) return\n                const range = this.#lastVisibleRange\n                if (!range) return\n                const sel = doc.getSelection()\n                if (!sel.rangeCount) return\n                if (isPointerSelecting && sel.type === 'Range')\n                    checkPointerSelection(range, sel)\n                else if (isKeyboardSelecting) {\n                    const selRange = sel.getRangeAt(0).cloneRange()\n                    const backward = selectionIsBackward(sel)\n                    if (!backward) selRange.collapse()\n                    this.#scrollToAnchor(selRange)\n                }\n            })\n            doc.addEventListener('focusin', e => this.scrolled ? null :\n                // NOTE: `requestAnimationFrame` is needed in WebKit\n                requestAnimationFrame(() => this.#scrollToAnchor(e.target)))\n        })\n\n        this.#mediaQueryListener = () => {\n            if (!this.#view) return\n            this.#background.style.background = getBackground(this.#view.document)\n        }\n        this.#mediaQuery.addEventListener('change', this.#mediaQueryListener)\n    }\n    attributeChangedCallback(name, _, value) {\n        switch (name) {\n            case 'flow':\n                this.render()\n                break\n            case 'gap':\n            case 'margin':\n            case 'max-block-size':\n            case 'max-column-count':\n                this.#top.style.setProperty('--_' + name, value)\n                break\n            case 'max-inline-size':\n                // needs explicit `render()` as it doesn't necessarily resize\n                this.#top.style.setProperty('--_' + name, value)\n                this.render()\n                break\n        }\n    }\n    open(book) {\n        this.bookDir = book.dir\n        this.sections = book.sections\n        book.transformTarget?.addEventListener('data', ({ detail }) => {\n            if (detail.type !== 'text/css') return\n            const w = innerWidth\n            const h = innerHeight\n            detail.data = Promise.resolve(detail.data).then(data => data\n                // unprefix as most of the props are (only) supported unprefixed\n                .replace(/(?<=[{\\s;])-epub-/gi, '')\n                // replace vw and vh as they cause problems with layout\n                .replace(/(\\d*\\.?\\d+)vw/gi, (_, d) => parseFloat(d) * w / 100 + 'px')\n                .replace(/(\\d*\\.?\\d+)vh/gi, (_, d) => parseFloat(d) * h / 100 + 'px')\n                // `page-break-*` unsupported in columns; replace with `column-break-*`\n                .replace(/page-break-(after|before|inside)\\s*:/gi, (_, x) =>\n                    `-webkit-column-break-${x}:`)\n                .replace(/break-(after|before|inside)\\s*:\\s*(avoid-)?page/gi, (_, x, y) =>\n                    `break-${x}: ${y ?? ''}column`))\n        })\n    }\n    #createView() {\n        if (this.#view) {\n            this.#view.destroy()\n            this.#container.removeChild(this.#view.element)\n        }\n        this.#view = new View({\n            container: this,\n            onExpand: () => this.#scrollToAnchor(this.#anchor),\n        })\n        this.#container.append(this.#view.element)\n        return this.#view\n    }\n    #beforeRender({ vertical, rtl, background }) {\n        this.#vertical = vertical\n        this.#rtl = rtl\n        this.#top.classList.toggle('vertical', vertical)\n\n        // set background to `doc` background\n        // this is needed because the iframe does not fill the whole element\n        this.#background.style.background = background\n\n        const { width, height } = this.#container.getBoundingClientRect()\n        const size = vertical ? height : width\n\n        const style = getComputedStyle(this.#top)\n        const maxInlineSize = parseFloat(style.getPropertyValue('--_max-inline-size'))\n        const maxColumnCount = parseInt(style.getPropertyValue('--_max-column-count-spread'))\n        const margin = parseFloat(style.getPropertyValue('--_margin'))\n        this.#margin = margin\n\n        const g = parseFloat(style.getPropertyValue('--_gap')) / 100\n        // The gap will be a percentage of the #container, not the whole view.\n        // This means the outer padding will be bigger than the column gap. Let\n        // `a` be the gap percentage. The actual percentage for the column gap\n        // will be (1 - a) * a. Let us call this `b`.\n        //\n        // To make them the same, we start by shrinking the outer padding\n        // setting to `b`, but keep the column gap setting the same at `a`. Then\n        // the actual size for the column gap will be (1 - b) * a. Repeating the\n        // process again and again, we get the sequence\n        //     x₁ = (1 - b) * a\n        //     x₂ = (1 - x₁) * a\n        //     ...\n        // which converges to x = (1 - x) * a. Solving for x, x = a / (1 + a).\n        // So to make the spacing even, we must shrink the outer padding with\n        //     f(x) = x / (1 + x).\n        // But we want to keep the outer padding, and make the inner gap bigger.\n        // So we apply the inverse, f⁻¹ = -x / (x - 1) to the column gap.\n        const gap = -g / (g - 1) * size\n\n        const flow = this.getAttribute('flow')\n        if (flow === 'scrolled') {\n            // FIXME: vertical-rl only, not -lr\n            this.setAttribute('dir', vertical ? 'rtl' : 'ltr')\n            this.#top.style.padding = '0'\n            const columnWidth = maxInlineSize\n\n            this.heads = null\n            this.feet = null\n            this.#header.replaceChildren()\n            this.#footer.replaceChildren()\n\n            return { flow, margin, gap, columnWidth }\n        }\n\n        const divisor = Math.min(maxColumnCount, Math.ceil(size / maxInlineSize))\n        const columnWidth = (size / divisor) - gap\n        this.setAttribute('dir', rtl ? 'rtl' : 'ltr')\n\n        const marginalDivisor = vertical\n            ? Math.min(2, Math.ceil(width / maxInlineSize))\n            : divisor\n        const marginalStyle = {\n            gridTemplateColumns: `repeat(${marginalDivisor}, 1fr)`,\n            gap: `${gap}px`,\n            direction: this.bookDir === 'rtl' ? 'rtl' : 'ltr',\n        }\n        Object.assign(this.#header.style, marginalStyle)\n        Object.assign(this.#footer.style, marginalStyle)\n        const heads = makeMarginals(marginalDivisor, 'head')\n        const feet = makeMarginals(marginalDivisor, 'foot')\n        this.heads = heads.map(el => el.children[0])\n        this.feet = feet.map(el => el.children[0])\n        this.#header.replaceChildren(...heads)\n        this.#footer.replaceChildren(...feet)\n\n        return { height, width, margin, gap, columnWidth }\n    }\n    render() {\n        if (!this.#view) return\n        this.#view.render(this.#beforeRender({\n            vertical: this.#vertical,\n            rtl: this.#rtl,\n        }))\n        this.#scrollToAnchor(this.#anchor)\n    }\n    get scrolled() {\n        return this.getAttribute('flow') === 'scrolled'\n    }\n    get scrollProp() {\n        const { scrolled } = this\n        return this.#vertical ? (scrolled ? 'scrollLeft' : 'scrollTop')\n            : scrolled ? 'scrollTop' : 'scrollLeft'\n    }\n    get sideProp() {\n        const { scrolled } = this\n        return this.#vertical ? (scrolled ? 'width' : 'height')\n            : scrolled ? 'height' : 'width'\n    }\n    get size() {\n        return this.#container.getBoundingClientRect()[this.sideProp]\n    }\n    get viewSize() {\n        return this.#view.element.getBoundingClientRect()[this.sideProp]\n    }\n    get start() {\n        return Math.abs(this.#container[this.scrollProp])\n    }\n    get end() {\n        return this.start + this.size\n    }\n    get page() {\n        return Math.floor(((this.start + this.end) / 2) / this.size)\n    }\n    get pages() {\n        return Math.round(this.viewSize / this.size)\n    }\n    scrollBy(dx, dy) {\n        const delta = this.#vertical ? dy : dx\n        const element = this.#container\n        const { scrollProp } = this\n        const [offset, a, b] = this.#scrollBounds\n        const rtl = this.#rtl\n        const min = rtl ? offset - b : offset - a\n        const max = rtl ? offset + a : offset + b\n        element[scrollProp] = Math.max(min, Math.min(max,\n            element[scrollProp] + delta))\n    }\n    snap(vx, vy) {\n        const velocity = this.#vertical ? vy : vx\n        const [offset, a, b] = this.#scrollBounds\n        const { start, end, pages, size } = this\n        const min = Math.abs(offset) - a\n        const max = Math.abs(offset) + b\n        const d = velocity * (this.#rtl ? -size : size)\n        const page = Math.floor(\n            Math.max(min, Math.min(max, (start + end) / 2\n                + (isNaN(d) ? 0 : d))) / size)\n\n        this.#scrollToPage(page, 'snap').then(() => {\n            const dir = page <= 0 ? -1 : page >= pages - 1 ? 1 : null\n            if (dir) return this.#goTo({\n                index: this.#adjacentIndex(dir),\n                anchor: dir < 0 ? () => 1 : () => 0,\n            })\n        })\n    }\n    #onTouchStart(e) {\n        const touch = e.changedTouches[0]\n        this.#touchState = {\n            x: touch?.screenX, y: touch?.screenY,\n            t: e.timeStamp,\n            vx: 0, xy: 0,\n        }\n    }\n    #onTouchMove(e) {\n        const state = this.#touchState\n        if (state.pinched) return\n        state.pinched = globalThis.visualViewport.scale > 1\n        if (this.scrolled || state.pinched) return\n        if (e.touches.length > 1) {\n            if (this.#touchScrolled) e.preventDefault()\n            return\n        }\n        e.preventDefault()\n        const touch = e.changedTouches[0]\n        const x = touch.screenX, y = touch.screenY\n        const dx = state.x - x, dy = state.y - y\n        const dt = e.timeStamp - state.t\n        state.x = x\n        state.y = y\n        state.t = e.timeStamp\n        state.vx = dx / dt\n        state.vy = dy / dt\n        this.#touchScrolled = true\n        this.scrollBy(dx, dy)\n    }\n    #onTouchEnd() {\n        this.#touchScrolled = false\n        if (this.scrolled) return\n\n        // XXX: Firefox seems to report scale as 1... sometimes...?\n        // at this point I'm basically throwing `requestAnimationFrame` at\n        // anything that doesn't work\n        requestAnimationFrame(() => {\n            if (globalThis.visualViewport.scale === 1)\n                this.snap(this.#touchState.vx, this.#touchState.vy)\n        })\n    }\n    // allows one to process rects as if they were LTR and horizontal\n    #getRectMapper() {\n        if (this.scrolled) {\n            const size = this.viewSize\n            const margin = this.#margin\n            return this.#vertical\n                ? ({ left, right }) =>\n                    ({ left: size - right - margin, right: size - left - margin })\n                : ({ top, bottom }) => ({ left: top + margin, right: bottom + margin })\n        }\n        const pxSize = this.pages * this.size\n        return this.#rtl\n            ? ({ left, right }) =>\n                ({ left: pxSize - right, right: pxSize - left })\n            : this.#vertical\n                ? ({ top, bottom }) => ({ left: top, right: bottom })\n                : f => f\n    }\n    async #scrollToRect(rect, reason) {\n        if (this.scrolled) {\n            const offset = this.#getRectMapper()(rect).left - this.#margin\n            return this.#scrollTo(offset, reason)\n        }\n        const offset = this.#getRectMapper()(rect).left\n        return this.#scrollToPage(Math.floor(offset / this.size) + (this.#rtl ? -1 : 1), reason)\n    }\n    async #scrollTo(offset, reason, smooth) {\n        const element = this.#container\n        const { scrollProp, size } = this\n        if (element[scrollProp] === offset) {\n            this.#scrollBounds = [offset, this.atStart ? 0 : size, this.atEnd ? 0 : size]\n            this.#afterScroll(reason)\n            return\n        }\n        // FIXME: vertical-rl only, not -lr\n        if (this.scrolled && this.#vertical) offset = -offset\n        if ((reason === 'snap' || smooth) && this.hasAttribute('animated')) return animate(\n            element[scrollProp], offset, 300, easeOutQuad,\n            x => element[scrollProp] = x,\n        ).then(() => {\n            this.#scrollBounds = [offset, this.atStart ? 0 : size, this.atEnd ? 0 : size]\n            this.#afterScroll(reason)\n        })\n        else {\n            element[scrollProp] = offset\n            this.#scrollBounds = [offset, this.atStart ? 0 : size, this.atEnd ? 0 : size]\n            this.#afterScroll(reason)\n        }\n    }\n    async #scrollToPage(page, reason, smooth) {\n        const offset = this.size * (this.#rtl ? -page : page)\n        return this.#scrollTo(offset, reason, smooth)\n    }\n    async scrollToAnchor(anchor, select) {\n        return this.#scrollToAnchor(anchor, select ? 'selection' : 'navigation')\n    }\n    async #scrollToAnchor(anchor, reason = 'anchor') {\n        this.#anchor = anchor\n        const rects = uncollapse(anchor)?.getClientRects?.()\n        // if anchor is an element or a range\n        if (rects) {\n            // when the start of the range is immediately after a hyphen in the\n            // previous column, there is an extra zero width rect in that column\n            const rect = Array.from(rects)\n                .find(r => r.width > 0 && r.height > 0) || rects[0]\n            if (!rect) return\n            await this.#scrollToRect(rect, reason)\n            return\n        }\n        // if anchor is a fraction\n        if (this.scrolled) {\n            await this.#scrollTo(anchor * this.viewSize, reason)\n            return\n        }\n        const { pages } = this\n        if (!pages) return\n        const textPages = pages - 2\n        const newPage = Math.round(anchor * (textPages - 1))\n        await this.#scrollToPage(newPage + 1, reason)\n    }\n    #getVisibleRange() {\n        if (this.scrolled) return getVisibleRange(this.#view.document,\n            this.start + this.#margin, this.end - this.#margin, this.#getRectMapper())\n        const size = this.#rtl ? -this.size : this.size\n        return getVisibleRange(this.#view.document,\n            this.start - size, this.end - size, this.#getRectMapper())\n    }\n    #afterScroll(reason) {\n        const range = this.#getVisibleRange()\n        this.#lastVisibleRange = range\n        // don't set new anchor if relocation was to scroll to anchor\n        if (reason !== 'selection' && reason !== 'navigation' && reason !== 'anchor')\n            this.#anchor = range\n        else this.#justAnchored = true\n\n        const index = this.#index\n        const detail = { reason, range, index }\n        if (this.scrolled) detail.fraction = this.start / this.viewSize\n        else if (this.pages > 0) {\n            const { page, pages } = this\n            this.#header.style.visibility = page > 1 ? 'visible' : 'hidden'\n            detail.fraction = (page - 1) / (pages - 2)\n            detail.size = 1 / (pages - 2)\n        }\n        this.dispatchEvent(new CustomEvent('relocate', { detail }))\n    }\n    async #display(promise) {\n        const { index, src, anchor, onLoad, select } = await promise\n        this.#index = index\n        const hasFocus = this.#view?.document?.hasFocus()\n        if (src) {\n            const view = this.#createView()\n            const afterLoad = doc => {\n                if (doc.head) {\n                    const $styleBefore = doc.createElement('style')\n                    doc.head.prepend($styleBefore)\n                    const $style = doc.createElement('style')\n                    doc.head.append($style)\n                    this.#styleMap.set(doc, [$styleBefore, $style])\n                }\n                onLoad?.({ doc, index })\n            }\n            const beforeRender = this.#beforeRender.bind(this)\n            await view.load(src, afterLoad, beforeRender)\n            this.dispatchEvent(new CustomEvent('create-overlayer', {\n                detail: {\n                    doc: view.document, index,\n                    attach: overlayer => view.overlayer = overlayer,\n                },\n            }))\n            this.#view = view\n        }\n        await this.scrollToAnchor((typeof anchor === 'function'\n            ? anchor(this.#view.document) : anchor) ?? 0, select)\n        if (hasFocus) this.focusView()\n    }\n    #canGoToIndex(index) {\n        return index >= 0 && index <= this.sections.length - 1\n    }\n    async #goTo({ index, anchor, select}) {\n        if (index === this.#index) await this.#display({ index, anchor, select })\n        else {\n            const oldIndex = this.#index\n            const onLoad = detail => {\n                this.sections[oldIndex]?.unload?.()\n                this.setStyles(this.#styles)\n                this.dispatchEvent(new CustomEvent('load', { detail }))\n            }\n            await this.#display(Promise.resolve(this.sections[index].load())\n                .then(src => ({ index, src, anchor, onLoad, select }))\n                .catch(e => {\n                    console.warn(e)\n                    console.warn(new Error(`Failed to load section ${index}`))\n                    return {}\n                }))\n        }\n    }\n    async goTo(target) {\n        if (this.#locked) return\n        const resolved = await target\n        if (this.#canGoToIndex(resolved.index)) return this.#goTo(resolved)\n    }\n    #scrollPrev(distance) {\n        if (!this.#view) return true\n        if (this.scrolled) {\n            if (this.start > 0) return this.#scrollTo(\n                Math.max(0, this.start - (distance ?? this.size)), null, true)\n            return true\n        }\n        if (this.atStart) return\n        const page = this.page - 1\n        return this.#scrollToPage(page, 'page', true).then(() => page <= 0)\n    }\n    #scrollNext(distance) {\n        if (!this.#view) return true\n        if (this.scrolled) {\n            if (this.viewSize - this.end > 2) return this.#scrollTo(\n                Math.min(this.viewSize, distance ? this.start + distance : this.end), null, true)\n            return true\n        }\n        if (this.atEnd) return\n        const page = this.page + 1\n        const pages = this.pages\n        return this.#scrollToPage(page, 'page', true).then(() => page >= pages - 1)\n    }\n    get atStart() {\n        return this.#adjacentIndex(-1) == null && this.page <= 1\n    }\n    get atEnd() {\n        return this.#adjacentIndex(1) == null && this.page >= this.pages - 2\n    }\n    #adjacentIndex(dir) {\n        for (let index = this.#index + dir; this.#canGoToIndex(index); index += dir)\n            if (this.sections[index]?.linear !== 'no') return index\n    }\n    async #turnPage(dir, distance) {\n        if (this.#locked) return\n        this.#locked = true\n        const prev = dir === -1\n        const shouldGo = await (prev ? this.#scrollPrev(distance) : this.#scrollNext(distance))\n        if (shouldGo) await this.#goTo({\n            index: this.#adjacentIndex(dir),\n            anchor: prev ? () => 1 : () => 0,\n        })\n        if (shouldGo || !this.hasAttribute('animated')) await wait(100)\n        this.#locked = false\n    }\n    prev(distance) {\n        return this.#turnPage(-1, distance)\n    }\n    next(distance) {\n        return this.#turnPage(1, distance)\n    }\n    prevSection() {\n        return this.goTo({ index: this.#adjacentIndex(-1) })\n    }\n    nextSection() {\n        return this.goTo({ index: this.#adjacentIndex(1) })\n    }\n    firstSection() {\n        const index = this.sections.findIndex(section => section.linear !== 'no')\n        return this.goTo({ index })\n    }\n    lastSection() {\n        const index = this.sections.findLastIndex(section => section.linear !== 'no')\n        return this.goTo({ index })\n    }\n    getContents() {\n        if (this.#view) return [{\n            index: this.#index,\n            overlayer: this.#view.overlayer,\n            doc: this.#view.document,\n        }]\n        return []\n    }\n    setStyles(styles) {\n        this.#styles = styles\n        const $$styles = this.#styleMap.get(this.#view?.document)\n        if (!$$styles) return\n        const [$beforeStyle, $style] = $$styles\n        if (Array.isArray(styles)) {\n            const [beforeStyle, style] = styles\n            $beforeStyle.textContent = beforeStyle\n            $style.textContent = style\n        } else $style.textContent = styles\n\n        // NOTE: needs `requestAnimationFrame` in Chromium\n        requestAnimationFrame(() =>\n            this.#background.style.background = getBackground(this.#view.document))\n\n        // needed because the resize observer doesn't work in Firefox\n        this.#view?.document?.fonts?.ready?.then(() => this.#view.expand())\n    }\n    focusView() {\n        this.#view.document.defaultView.focus()\n    }\n    destroy() {\n        this.#observer.unobserve(this)\n        this.#view.destroy()\n        this.#view = null\n        this.sections[this.#index]?.unload?.()\n        this.#mediaQuery.removeEventListener('change', this.#mediaQueryListener)\n    }\n}\n\ncustomElements.define('foliate-paginator', Paginator)\n"],"names":["wait","ms","resolve","debounce","f","immediate","timeout","args","later","lerp","min","max","x","easeOutQuad","animate","a","b","duration","ease","render","start","step","now","fraction","uncollapse","range","endOffset","endContainer","node","makeRange","doc","end","bisectNode","cb","mid","result","SHOW_ELEMENT","SHOW_TEXT","SHOW_CDATA_SECTION","FILTER_ACCEPT","FILTER_REJECT","FILTER_SKIP","filter","getBoundingClientRect","target","top","right","left","bottom","rect","getVisibleRange","mapRect","acceptNode","name","walker","nodes","from","to","startOffset","p","q","selectionIsBackward","sel","setSelectionTo","collapse","getDirection","defaultView","writingMode","direction","vertical","rtl","getBackground","bodyStyle","makeMarginals","length","part","div","child","setStylesImportant","el","styles","style","k","v","View","#observer","#element","#iframe","#contentRange","#overlayer","#vertical","#rtl","#column","#size","#layout","container","onExpand","src","afterLoad","beforeRender","background","layout","gap","columnWidth","width","height","margin","maxHeight","maxWidth","documentElement","side","otherSide","contentRect","rootRect","contentSize","expandedSize","padding","overlayer","Paginator","#root","#top","#background","#container","#header","#footer","#view","#margin","#index","#anchor","#justAnchored","#locked","#styles","#styleMap","#mediaQuery","#mediaQueryListener","#scrollBounds","#touchState","#touchScrolled","#lastVisibleRange","#afterScroll","opts","#onTouchStart","#onTouchMove","#onTouchEnd","detail","checkPointerSelection","selRange","backward","isPointerSelecting","isKeyboardSelecting","#scrollToAnchor","e","_","value","book","w","h","data","d","y","#createView","#beforeRender","size","maxInlineSize","maxColumnCount","g","flow","divisor","marginalDivisor","marginalStyle","heads","feet","scrolled","dx","dy","delta","element","scrollProp","offset","vx","vy","velocity","pages","page","#scrollToPage","dir","#goTo","#adjacentIndex","touch","state","dt","#getRectMapper","pxSize","#scrollToRect","reason","#scrollTo","smooth","anchor","select","rects","r","textPages","newPage","#getVisibleRange","index","#display","promise","onLoad","hasFocus","view","$styleBefore","$style","#canGoToIndex","oldIndex","resolved","#scrollPrev","distance","#scrollNext","#turnPage","prev","shouldGo","section","$$styles","$beforeStyle","beforeStyle"],"mappings":"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","x_google_ignoreList":[0]}